<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;16.&nbsp;HBase</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="JanusGraph Documentation"><link rel="up" href="storage-backends.html" title="Part&nbsp;III.&nbsp;Storage Backends"><link rel="prev" href="cassandra.html" title="Chapter&nbsp;15.&nbsp;Cassandra"><link rel="next" href="bigtable.html" title="Chapter&nbsp;17.&nbsp;Google Cloud Bigtable"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-1.11.0.js"></script><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-migrate-1.2.1.min.js"></script><link xmlns:d="http://docbook.org/ns/docbook" rel="stylesheet" id="inline-blob-janusgraph-docs-specific" href="css/docs.css" type="text/css" media="all"><link xmlns:d="http://docbook.org/ns/docbook" rel="apple-touch-icon" type="image/png" href="images/janusgraph-logomark.png"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript">
      WebFontConfig = {
        google: {
          families: [
            "Lato:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Open+Sans:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Antic+Slab:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese"
          ]
        }
      };
      (function() {
      var wf = document.createElement('script');
      wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
        '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
	wf.type = 'text/javascript';
	wf.async = 'true';
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(wf, s);
	})();
    </script></head><body xmlns:d="http://docbook.org/ns/docbook" bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div id="wrapper"><div class="header-wrapper"><header id="header"><ul class="header-list"><li class="header-item"><a href="http://janusgraph.org"><img src="images/janusgraph-logo.png" alt="JanusGraph" class="normal_logo"></a></li><li class="header-item-right"><a href="https://github.com/JanusGraph/janusgraph/releases">Download JanusGraph</a></li><li class="header-item-right"><a href="https://github.com/JanusGraph/janusgraph/releases">Other Versions</a></li><li class="header-item-right"><a href="index.html">Documentation (0.2.0-SNAPSHOT)</a></li></ul></header></div><div id="main" class="clearfix width-100"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">JanusGraph Documentation</a></span> &gt; <span class="breadcrumb-link"><a href="storage-backends.html">Storage Backends</a></span> &gt; <span class="breadcrumb-node">HBase</span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="hbase"></a>Chapter&nbsp;16.&nbsp;HBase</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="hbase.html#_hbase_setup">16.1. HBase Setup</a></span></dt><dd><dl><dt><span class="section"><a href="hbase.html#_local_server_mode">16.1.1. Local Server Mode</a></span></dt><dt><span class="section"><a href="hbase.html#_remote_server_mode_2">16.1.2. Remote Server Mode</a></span></dt><dt><span class="section"><a href="hbase.html#_remote_server_mode_with_gremlin_server_2">16.1.3. Remote Server Mode with Gremlin Server</a></span></dt></dl></dd><dt><span class="section"><a href="hbase.html#_hbase_specific_configuration">16.2. HBase Specific Configuration</a></span></dt><dt><span class="section"><a href="hbase.html#_global_graph_operations_2">16.3. Global Graph Operations</a></span></dt><dt><span class="section"><a href="hbase.html#_deploying_on_amazon_ec2_2">16.4. Deploying on Amazon EC2</a></span></dt><dt><span class="section"><a href="hbase.html#_tips_and_tricks_for_managing_an_hbase_cluster">16.5. Tips and Tricks for Managing an HBase Cluster</a></span></dt></dl></div><p class="tss-center tss-width-250"><span class="inlinemediaobject"><img src="http://hbase.apache.org/images/hbase_logo.png" alt="hbase_logo"></span></p><div class="blockquote"><table border="0" class="blockquote" style="width: 100%; cellspacing: 0; cellpadding: 0;" summary="Block quote"><tr><td width="10%" valign="top">&nbsp;</td><td width="80%" valign="top"><p>Apache HBase is an open-source, distributed, versioned, non-relational database modeled after <a class="link" href="http://static.googleusercontent.com/media/research.google.com/en/us/archive/bigtable-osdi06.pdf" target="_top">Google&#8217;s Bigtable: A Distributed Storage System for Structured Data by Chang et al.</a> Just as Bigtable leverages the distributed data storage provided by the Google File System, Apache HBase provides Bigtable-like capabilities on top of Hadoop and HDFS.</p></td><td width="10%" valign="top">&nbsp;</td></tr><tr><td width="10%" valign="top">&nbsp;</td><td colspan="2" align="right" valign="top">--<span class="attribution">
    
    <a class="link" href="http://hbase.apache.org/" target="_top">Apache HBase Homepage</a>
    
    
  </span></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_hbase_setup"></a>16.1.&nbsp;HBase Setup</h2></div></div></div><p>The following sections outline the various ways in which JanusGraph can be used in concert with HBase.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_local_server_mode"></a>16.1.1.&nbsp;Local Server Mode</h3></div></div></div><p><span class="inlinemediaobject"><img src="images/modes-local.png" alt="modes-local"></span></p><p>HBase can be run as a standalone database on the same local host as JanusGraph and the end-user application. In this model, JanusGraph and HBase communicate with one another via a <code class="literal">localhost</code> socket. Running JanusGraph over HBase requires the following setup steps:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Download and extract a stable HBase from <a class="link" href="http://www.apache.org/dyn/closer.cgi/hbase/stable/" target="_top">http://www.apache.org/dyn/closer.cgi/hbase/stable/</a>.</li><li class="listitem">Start HBase by invoking the <code class="literal">start-hbase.sh</code> script in the <span class="emphasis"><em>bin</em></span> directory inside the extracted HBase directory. To stop HBase, use <code class="literal">stop-hbase.sh</code>.</li></ul></div><pre class="programlisting">$ ./bin/start-hbase.sh
starting master, logging to ../logs/hbase-master-machine-name.local.out</pre><p>Now, you can create an HBase JanusGraph as follows:</p><pre class="programlisting">JanusGraph graph = JanusGraphFactory.build()
	.set(<span class="hl-string">"storage.backend"</span>, <span class="hl-string">"hbase"</span>)
	.open();</pre><p>Note, that you do not need to specify a hostname since a localhost connection is attempted by default. Also, in the Gremlin shell, you can not define the type of the variables <code class="literal">conf</code> and <code class="literal">g</code>. Therefore, simply leave off the type declaration.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_remote_server_mode_2"></a>16.1.2.&nbsp;Remote Server Mode</h3></div></div></div><p><span class="inlinemediaobject"><img src="images/modes-distributed.png" alt="modes-distributed"></span></p><p>When the graph needs to scale beyond the confines of a single machine, then HBase and JanusGraph are logically separated into different machines. In this model, the HBase cluster maintains the graph representation and any number of JanusGraph instances maintain socket-based read/write access to the HBase cluster. The end-user application can directly interact with JanusGraph within the same JVM as JanusGraph.</p><p>For example, suppose we have a running HBase cluster with a ZooKeeper quorum composed of three machines at IP address 77.77.77.77, 77.77.77.78, and 77.77.77.79, then connecting JanusGraph with the cluster is accomplished as follows:</p><pre class="programlisting">JanusGraph g = JanusGraphFactory.build()
	.set(<span class="hl-string">"storage.backend"</span>, <span class="hl-string">"hbase"</span>)
	.set(<span class="hl-string">"storage.hostname"</span>, <span class="hl-string">"77.77.77.77, 77.77.77.78, 77.77.77.79"</span>)
	.open();</pre><p><code class="literal">storage.hostname</code> accepts a comma separated list of IP addresses and hostname for any subset of machines in the HBase cluster JanusGraph should connect to. Also, in the Gremlin shell, you can not define the type of the variables <code class="literal">conf</code> and <code class="literal">g</code>. Therefore, simply leave off the type declaration.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_remote_server_mode_with_gremlin_server_2"></a>16.1.3.&nbsp;Remote Server Mode with Gremlin Server</h3></div></div></div><p><span class="inlinemediaobject"><img src="images/modes-rexster.png" alt="modes-rexster"></span></p><p>Finally, Gremlin server can be wrapped around each JanusGraph instance defined in the previous subsection. In this way, the end-user application need not be a Java-based application as it can communicate with Gremlin server as a client. This type of deployment is great for polyglot architectures where various components written in different languages need to reference and compute on the graph.</p><pre class="screen">http://gremlin-server.janusgraph.machine1/mygraph/vertices/1
http://gremlin-server.janusgraph.machine2/mygraph/tp/gremlin?script=g.v(1).out('follows').out('created')</pre><p>In this case, each Gremlin server server would be configured to connect to the HBase cluster. The following shows the graph specific fragment of the Gremlin server configuration. Refer to <a class="xref" href="server.html" title="Chapter&nbsp;7.&nbsp;JanusGraph Server">Chapter&nbsp;7, <i>JanusGraph Server</i></a> for a complete example and more information on how to configure the server.</p><pre class="programlisting">...
graphs: {
  g: conf/janusgraph-hbase.properties}
plugins:
  - janusgraph.imports
...</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_hbase_specific_configuration"></a>16.2.&nbsp;HBase Specific Configuration</h2></div></div></div><p>Refer to <a class="xref" href="config-ref.html" title="Chapter&nbsp;12.&nbsp;Configuration Reference">Chapter&nbsp;12, <i>Configuration Reference</i></a> for a complete listing of all HBase specific configuration options in addition to the general JanusGraph configuration options.</p><p>When configuring HBase it is recommended to consider the following HBase specific configuration options:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>tablename</strong></span>: Name of the HBase table in which to store the JanusGraph graph. Allows multiple JanusGraph graphs to co-exist in the same HBase cluster.</li></ul></div><p>Please refer to the <a class="link" href="http://hbase.apache.org/book/config.files.html" target="_top">HBase configuration documentation</a> for more HBase configuration options and their description. By prefixing the respective HBase configuration option with <code class="literal">storage.hbase.ext</code> in the JanusGraph configuration it will be passed on to HBase at initialization time. For example, to use the znode /hbase-secure for HBase, set the property: <code class="literal">storage.hbase.ext.zookeeper.znode.parent=/hbase-secure</code>. The prefix allows arbitrary HBase configuration options to be configured through JanusGraph.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_global_graph_operations_2"></a>16.3.&nbsp;Global Graph Operations</h2></div></div></div><p>JanusGraph over HBase supports global vertex and edge iteration. However, note that all these vertices and/or edges will be loaded into memory which can cause <code class="literal">OutOfMemoryException</code>. Use <a class="xref" href="hadoop-tp3.html" title="Chapter&nbsp;34.&nbsp;JanusGraph with TinkerPop&#8217;s Hadoop-Gremlin">Chapter&nbsp;34, <i>JanusGraph with TinkerPop&#8217;s Hadoop-Gremlin</i></a> to iterate over all vertices or edges in large graphs effectively.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_deploying_on_amazon_ec2_2"></a>16.4.&nbsp;Deploying on Amazon EC2</h2></div></div></div><div class="blockquote"><table border="0" class="blockquote" style="width: 100%; cellspacing: 0; cellpadding: 0;" summary="Block quote"><tr><td width="10%" valign="top">&nbsp;</td><td width="80%" valign="top"><p>Amazon EC2 is a web service that provides resizable compute capacity in the cloud. It is designed to make web-scale computing easier for developers.</p></td><td width="10%" valign="top">&nbsp;</td></tr><tr><td width="10%" valign="top">&nbsp;</td><td colspan="2" align="right" valign="top">--<span class="attribution">
    
    <a class="link" href="http://aws.amazon.com/ec2/" target="_top">Amazon EC2</a>
    
    
  </span></td></tr></table></div><p>Follow these steps to setup an HBase cluster on EC2 and deploy JanusGraph over HBase. To follow these instructions, you need an Amazon AWS account with established authentication credentials and some basic knowledge of AWS and EC2.</p><p>The following commands first launch a four-node HBase cluster on EC2 via <a class="link" href="http://whirr.apache.org/" target="_top">Whirr</a>, then run a basic JanusGraph test case using the cluster.</p><p>The configuration described below puts one HBase master server in charge of three HBase regionservers.  The master will be the sole member of the Zookeeper quorum by which JanusGraph connects to HBase.</p><p>Whirr 0.7.1 sometimes fails when run on a machine behind a NAT <a class="link" href="https://issues.apache.org/jira/browse/WHIRR-459" target="_top">WHIRR-459</a>.  For this reason, it&#8217;s recommended to use at least Whirr 0.7.2.  Whirr 0.8.0 was used to test the following commands on a t1.micro instance running Amazon Linux 2012.03.  These commands might need tweaking to produce the intended results on environments besides a t1.micro instance running Amazon Linux 2012.03.</p><pre class="programlisting"><em class="hl-comment"># These commands were executed on a t1.micro instance running Amazon Linux 2012.03 x86_64.</em>
<em class="hl-comment"># The AMI identifier for Amazon Linux 2012.03 x86_64 is ami-aecd60c7.</em>
<em class="hl-comment"># https://console.aws.amazon.com/ec2/home?region=us-east-1#launchAmi=ami-aecd60c7</em>
<strong class="hl-keyword">export</strong> AWS_ACCESS_KEY_ID=... <em class="hl-comment"># Set your Access Key here</em>
<strong class="hl-keyword">export</strong> AWS_SECRET_ACCESS_KEY=... <em class="hl-comment"># Set your Secret Key here</em>
curl -O http://www.apache.org/dist/whirr/whirr-<span class="hl-number">0.8</span>.<span class="hl-number">0</span>/whirr-<span class="hl-number">0.8</span>.<span class="hl-number">0.</span>tar.gz
tar -xzf whirr-<span class="hl-number">0.8</span>.<span class="hl-number">0.</span>tar.gz &amp;&amp; <strong class="hl-keyword">cd</strong> whirr-<span class="hl-number">0.8</span>.<span class="hl-number">0</span>
<em class="hl-comment"># Generate an SSH keypair with which Whirr will deploy and manage instances</em>
ssh-keygen -t rsa -P <span class="hl-string">''</span> -f ~/.ssh/id_rsa_whirr
<em class="hl-comment"># Download a Whirr recipe for deploying HBase 0.94.1 with hadoop-core 1.0.3</em>
pushd recipes &amp;&amp; wget <span class="hl-string">'https://raw.github.com/JanusGraph/janusgraph/master/config/whirr-hbase.properties'</span> ; popd
bin/whirr launch-cluster --config recipes/whirr-hbase.properties --private-key-file ~/.ssh/id_rsa_whirr
<em class="hl-comment"># Run a superficial health check on the hbase-master node (this should print "imok")</em>
<strong class="hl-keyword">echo</strong> <span class="hl-string">"ruok"</span> | nc $(awk <span class="hl-string">'{print $3}'</span> ~/.whirr/hbase-testing/instances | head -<span class="hl-number">1</span>) <span class="hl-number">2181</span>; <strong class="hl-keyword">echo</strong>
<em class="hl-comment"># Login to the HBase master node to run the remaining commands</em>
ssh -i ~/.ssh/id_rsa_whirr -o <span class="hl-string">"UserKnownHostsFile /dev/null"</span> \
      -o StrictHostKeyChecking=no \
      `grep hbase-master ~/.whirr/hbase-testing/instances \
      | awk <span class="hl-string">'{print $3}'</span>`
<em class="hl-comment"># Maven 2 is available through the package manager, but an incompatibility</em>
<em class="hl-comment"># with surefire 2.12 makes it a pain to use; here we download Maven 3 without</em>
<em class="hl-comment"># the OS package manager</em>
wget <span class="hl-string">'http://archive.apache.org/dist/maven/maven-3/3.0.4/binaries/apache-maven-3.0.4-bin.tar.gz'</span>
tar -xzf apache-maven-<span class="hl-number">3.0</span>.<span class="hl-number">4</span>-bin.tar.gz
<em class="hl-comment"># Install git</em>
sudo apt-get install -y git-core
<em class="hl-comment"># Clone JanusGraph</em>
git clone <span class="hl-string">'git://github.com/JanusGraph/janusgraph.git'</span> &amp;&amp; <strong class="hl-keyword">cd</strong> janusgraph
<em class="hl-comment"># Run a HBase-backed test of JanusGraph</em>
<em class="hl-comment">#</em>
<em class="hl-comment"># This test should produce pages of output ending in something like this:</em>
<em class="hl-comment">#</em>
<em class="hl-comment"># -------------------------------------------------------</em>
<em class="hl-comment">#  T E S T S</em>
<em class="hl-comment"># -------------------------------------------------------</em>
<em class="hl-comment"># Running org.janusgraph.graphdb.hbase.ExternalHBaseGraphPerformanceTest</em>
<em class="hl-comment"># Starting trial 1/1</em>
<em class="hl-comment"># 10000</em>
<em class="hl-comment"># 20000</em>
<em class="hl-comment"># 30000</em>
<em class="hl-comment"># 40000</em>
<em class="hl-comment"># 50000</em>
<em class="hl-comment"># Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 303.659 sec</em>
<em class="hl-comment">#</em>
<em class="hl-comment"># Results :</em>
<em class="hl-comment">#</em>
<em class="hl-comment"># Tests run: 1, Failures: 0, Errors: 0, Skipped: 0</em>
<em class="hl-comment">#</em>
<em class="hl-comment"># [INFO] ------------------------------------------------------------------------</em>
<em class="hl-comment"># [INFO] BUILD SUCCESS</em>
<em class="hl-comment"># [INFO] ------------------------------------------------------------------------</em>
~/apache-maven-<span class="hl-number">3.0</span>.<span class="hl-number">4</span>/bin/mvn <strong class="hl-keyword">test</strong> -Dtest=ExternalHBaseGraphPerformanceTest<em class="hl-comment">#unlabeledEdgeInsertion</em>
<em class="hl-comment"># Check on hadoop</em>
hadoop version <em class="hl-comment"># Should print 1.0.3</em>
<em class="hl-comment"># List the hadoop root; should print something like:</em>
<em class="hl-comment">#</em>
<em class="hl-comment"># Found 4 items</em>
<em class="hl-comment"># drwxr-xr-x   - hadoop supergroup          0 2012-09-20 00:20 /hadoop</em>
<em class="hl-comment"># drwxr-xr-x   - hadoop supergroup          0 2012-09-20 00:42 /hbase</em>
<em class="hl-comment"># drwxrwxrwx   - hadoop supergroup          0 2012-09-20 00:20 /tmp</em>
<em class="hl-comment"># drwxrwxrwx   - hadoop supergroup          0 2012-09-20 00:20 /user</em>
hadoop fs -ls /</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_tips_and_tricks_for_managing_an_hbase_cluster"></a>16.5.&nbsp;Tips and Tricks for Managing an HBase Cluster</h2></div></div></div><p>The <a class="link" href="http://wiki.apache.org/hadoop/Hbase/Shell" target="_top">HBase shell</a> on the master server can be used to get an overal status check of the cluster.</p><pre class="programlisting">$HBASE_HOME/bin/hbase shell</pre><p>From the shell, the following commands are generally useful for understanding the status of the cluster.</p><pre class="programlisting">status 'janusgraph'
status 'simple'
status 'detailed'</pre><p>The above commands can identify if a region server has gone down. If so, it is possible to <code class="literal">ssh</code> into the failed region server machines and do the following:</p><pre class="programlisting">sudo -u hadoop $HBASE_HOME/bin/hbase-daemon.sh stop regionserver
sudo -u hadoop $HBASE_HOME/bin/hbase-daemon.sh start regionserver</pre><p>The use of <a class="link" href="http://code.google.com/p/parallel-ssh/" target="_top">pssh</a> can make this process easy as there is no need to log into each machine individually to run the commands. Put the IP addresses of the regionservers into a <code class="literal">hosts.txt</code> file and then execute the following.</p><pre class="programlisting">pssh -h host.txt sudo -u hadoop $HBASE_HOME/bin/hbase-daemon.sh stop regionserver
pssh -h host.txt sudo -u hadoop $HBASE_HOME/bin/hbase-daemon.sh start regionserver</pre><p>Next, sometimes you need to restart the master server (e.g. connection refused exceptions). To do so, on the master execute the following:</p><pre class="programlisting">sudo -u hadoop $HBASE_HOME/bin/hbase-daemon.sh stop master
sudo -u hadoop $HBASE_HOME/bin/hbase-daemon.sh start master</pre><p>Finally, if an HBase cluster has already been deployed and more memory is required of the master or region servers, simply edit the <code class="literal">$HBASE_HOME/conf/hbase-env.sh</code> files on the respective machines with requisite <code class="literal">-Xmx -Xms</code> parameters. Once edited, stop/start the master and/or region servers as described previous.</p></div></div></div><div class="clearer"></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="cassandra.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="storage-backends.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="bigtable.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;15.&nbsp;Cassandra&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;17.&nbsp;Google Cloud Bigtable</td></tr></table></div><div class="footer-wrapper"><footer id="footer"><div class="copyright">
              Copyright &copy; 2017 JanusGraph Authors. All rights reserved.<br>
              The Linux Foundation has registered trademarks and uses trademarks. For a list of<br>
              trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage">Trademark Usage</a> page.<br>
              Cassandra, Groovy, HBase, Hadoop, Lucene, Solr, and TinkerPop are trademarks of the Apache Software Foundation.<br>
              Berkeley DB and Berkeley DB Java Edition are trademarks of Oracle.<br>
              Documentation generated with <a href="http://www.methods.co.nz/asciidoc/">AsciiDoc</a>, <a href="http://asciidoctor.org/">AsciiDoctor</a>, <a href="http://docbook.sourceforge.net/">DocBook</a>, and <a href="http://saxon.sourceforge.net/">Saxon</a>.
        	  </div></footer></div></div></body></html>