<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;43.&nbsp;JanusGraph Data Model</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="JanusGraph Documentation"><link rel="up" href="internals.html" title="Part&nbsp;VII.&nbsp;JanusGraph Internals"><link rel="prev" href="internals.html" title="Part&nbsp;VII.&nbsp;JanusGraph Internals"><link rel="next" href="building.html" title="Chapter&nbsp;44.&nbsp;Building JanusGraph"><script xmlns:d="https://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-1.11.0.js"></script><script xmlns:d="https://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-migrate-1.2.1.min.js"></script><link xmlns:d="https://docbook.org/ns/docbook" rel="stylesheet" id="inline-blob-janusgraph-docs-specific" href="css/docs.css" type="text/css" media="all"><link xmlns:d="https://docbook.org/ns/docbook" rel="apple-touch-icon" type="image/png" href="images/janusgraph-logomark.png"><script xmlns:d="https://docbook.org/ns/docbook" type="text/javascript">
      WebFontConfig = {
        google: {
          families: [
            "Lato:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Open+Sans:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Antic+Slab:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese"
          ]
        }
      };
      (function() {
      var wf = document.createElement('script');
      wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
        '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
	wf.type = 'text/javascript';
	wf.async = 'true';
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(wf, s);
	})();
    </script></head><body xmlns:d="https://docbook.org/ns/docbook" bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div id="wrapper"><div class="header-wrapper"><header id="header"><ul class="header-list"><li class="header-item"><a href="https://janusgraph.org"><img src="images/janusgraph-logo.png" alt="JanusGraph" class="normal_logo"></a></li><li class="header-item-right"><a href="https://github.com/JanusGraph/janusgraph/releases">Download JanusGraph</a></li><li class="header-item-right dropdown"><a href="https://docs.janusgraph.org/latest/doc-versions.html">Other Doc Versions</a><div class="dropdown-content"><a href="https://docs.janusgraph.org/latest/index.html">Latest</a><a href="https://docs.janusgraph.org/0.4.0/index.html">Version 0.4.0</a><a href="https://docs.janusgraph.org/0.3.2/index.html">Version 0.3.2</a><a href="https://docs.janusgraph.org/0.3.1/index.html">Version 0.3.1</a><a href="https://docs.janusgraph.org/0.3.0/index.html">Version 0.3.0</a><a href="https://docs.janusgraph.org/0.2.3/index.html">Version 0.2.3</a><a href="https://docs.janusgraph.org/0.2.2/index.html">Version 0.2.2</a><a href="https://docs.janusgraph.org/0.2.1/index.html">Version 0.2.1</a><a href="https://docs.janusgraph.org/0.2.0/index.html">Version 0.2.0</a><a href="https://docs.janusgraph.org/0.1.1/index.html">Version 0.1.1</a><a href="https://docs.janusgraph.org/0.1.0/index.html">Version 0.1.0</a></div></li><li class="header-item-right"><a href="index.html">Documentation (0.4.0)</a></li></ul></header></div><div id="main" class="clearfix width-100"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">JanusGraph Documentation</a></span> &gt; <span class="breadcrumb-link"><a href="internals.html">JanusGraph Internals</a></span> &gt; <span class="breadcrumb-node">JanusGraph Data Model</span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="data-model"></a>Chapter&nbsp;43.&nbsp;JanusGraph Data Model</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="data-model.html#_bigtable_data_model">43.1. Bigtable Data Model</a></span></dt><dt><span class="section"><a href="data-model.html#_janusgraph_data_layout">43.2. JanusGraph Data Layout</a></span></dt><dt><span class="section"><a href="data-model.html#_individual_edge_layout">43.3. Individual Edge Layout</a></span></dt></dl></div>

<p>JanusGraph stores graphs in <a class="link" href="https://en.wikipedia.org/wiki/Adjacency_list" target="_top">adjacency list format</a> which means that a graph is stored as a collection of vertices with their adjacency list. The adjacency list of a vertex contains all of the vertex&#8217;s incident edges (and properties).</p>
<p>By storing a graph in adjacency list format JanusGraph ensures that all of a vertex&#8217;s incident edges and properties are stored compactly in the storage backend which speeds up traversals. The downside is that each edge has to be stored twice - once for each end vertex of the edge.</p>
<p>In addition, JanusGraph maintains the adjacency list of each vertex in sort order with the order being defined by the sort key and sort order the edge labels. The sort order enables efficient retrievals of subsets of the adjacency list using <a class="link" href="indexes.html#vertex-indexes" title="11.2.&nbsp;Vertex-centric Indexes">vertex centric indices</a>.</p>
<p>JanusGraph stores the adjacency list representation of a graph in any <a class="link" href="storage-backends.html" title="Part&nbsp;IV.&nbsp;Storage Backends">storage backend</a> that supports the Bigtable data model.</p>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_bigtable_data_model"></a>43.1.&nbsp;Bigtable Data Model</h2></div></div></div>

<p class="tss-center"><span class="inlinemediaobject"><img src="images/bigtablemodel.png" alt="bigtablemodel"></span></p>
<p>Under the <a class="link" href="https://en.wikipedia.org/wiki/Bigtable" target="_top">Bigtable data model</a> each table is a collection of rows. Each row is uniquely identified by a key. Each row is comprised of an arbitrary (large, but limited) number of cells. A cell is composed of a column and value. A cell is uniquely identified by a column within a given row. Rows in the Bigtable model are called "wide rows" because they support a large number of cells and the columns of those cells don&#8217;t have to be defined up front as is required in relational databases.</p>
<p>JanusGraph has an additional requirement for the Bigtable data model: The cells must be sorted by their columns and a subset of the cells specified by a column range must be efficiently retrievable (e.g. by using index structures, skip lists, or binary search).</p>
<p>In addition, a particular Bigtable implementation may keep the rows sorted in the order of their key. JanusGraph can exploit such key-order to effectively partition the graph which provides better loading and traversal performance for very large graphs. However, this is not a requirement.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_janusgraph_data_layout"></a>43.2.&nbsp;JanusGraph Data Layout</h2></div></div></div>

<p class="tss-center"><span class="inlinemediaobject"><img src="images/storagelayout.png" alt="storagelayout"></span></p>
<p>JanusGraph stores each adjacency list as a row in the underlying storage backend. The (64 bit) vertex id (which JanusGraph uniquely assigns to every vertex) is the key which points to the row containing the vertex&#8217;s adjacency list. Each edge and property is stored as an individual cell in the row which allows for efficient insertions and deletions.
The maximum number of cells allowed per row in a particular storage backend is therefore also the maximum degree of a vertex that JanusGraph can support against this backend.</p>
<p>If the storage backend supports key-order, the adjacency lists will be ordered by vertex id, and JanusGraph can assign vertex ids such that the graph is effectively partitioned. Ids are assigned such that vertices which are frequently co-accessed have ids with small absolute difference.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_individual_edge_layout"></a>43.3.&nbsp;Individual Edge Layout</h2></div></div></div>

<p class="tss-center"><span class="inlinemediaobject"><img src="images/relationlayout.png" alt="relationlayout"></span></p>
<p>Each edge and property is stored as one cell in the rows of its adjacent vertices. They are serialized such that the byte order of the column respects the sort key of the edge label. Variable id encoding schemes and compressed object serialization are used to keep the storage footprint of each edge/cell as small as possible.</p>
<p>Consider the storage layout of an individual edge as visualized in the top row of the graphic above. The dark blue boxes represent numbers that are encoded with a variable length encoding scheme to reduce the number of bytes they consume. Red boxes represent one or multiple property values (i.e. objects) that are serialized with compressed meta data referenced in the associated property key. Grey boxes represent uncompressed property values (i.e. serialized objects).</p>
<p>The serialized representation of an edge starts with the edge label&#8217;s unique id (as assigned by JanusGraph). This is typically a small number and compressed well with variable id encoding. The last bit of this id is offset to store whether this is an incoming or outgoing edge. Next, the property value comprising the sort key are stored. The sort key is defined with the edge label and hence the sort key objects meta data can be referenced to the edge label. After that, the id of the adjacent vertex is stored. JanusGraph does not store the actual vertex id but the difference to the id of the vertex that owns this adjacency list. It is likely that the difference is a smaller number than the absolute id and hence compresses better. The vertex id is followed by the id of this edge. Each edge is assigned a unique id by JanusGraph. This concludes the column value of the edge&#8217;s cell. The value of the edge&#8217;s cell contains the compressed serialization of the signature properties of the edge (as defined by the label&#8217;s signature key) and any other properties that have been added to the edge in uncompressed serialization.</p>
<p>The serialized representation of a property is simpler and only contains the property&#8217;s key id in the column. The property id and the property value are stored in the value. If the property key is defined as <code class="literal">list()</code>, however, the property id is stored in the column as well.</p>
</div>
</div></div><div class="clearer"></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="internals.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="internals.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="building.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Part&nbsp;VII.&nbsp;JanusGraph Internals&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;44.&nbsp;Building JanusGraph</td></tr></table></div><div class="footer-wrapper"><footer id="footer"><div class="copyright">
              Copyright &copy; 2017 JanusGraph Authors. All rights reserved.<br>
              The Linux Foundation has registered trademarks and uses trademarks. For a list of<br>
              trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage">Trademark Usage</a> page.<br>
              Cassandra, Groovy, HBase, Hadoop, Lucene, Solr, and TinkerPop are trademarks of the Apache Software Foundation.<br>
              Berkeley DB and Berkeley DB Java Edition are trademarks of Oracle.<br>
              Documentation generated with <a href="https://www.methods.co.nz/asciidoc/">AsciiDoc</a>, <a href="https://asciidoctor.org/">AsciiDoctor</a>, <a href="http://docbook.sourceforge.net/">DocBook</a>, and <a href="http://saxon.sourceforge.net/">Saxon</a>.
        	  </div></footer></div></div></body></html>