<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;26.&nbsp;Index Parameters and Full-Text Search</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="JanusGraph Documentation"><link rel="up" href="index-backends.html" title="Part&nbsp;V.&nbsp;Index Backends"><link rel="prev" href="search-predicates.html" title="Chapter&nbsp;25.&nbsp;Search Predicates and Data Types"><link rel="next" href="field-mapping.html" title="Chapter&nbsp;27.&nbsp;Field Mapping"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-1.11.0.js"></script><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-migrate-1.2.1.min.js"></script><link xmlns:d="http://docbook.org/ns/docbook" rel="stylesheet" id="inline-blob-janusgraph-docs-specific" href="css/docs.css" type="text/css" media="all"><link xmlns:d="http://docbook.org/ns/docbook" rel="apple-touch-icon" type="image/png" href="images/janusgraph-logomark.png"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript">
      WebFontConfig = {
        google: {
          families: [
            "Lato:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Open+Sans:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Antic+Slab:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese"
          ]
        }
      };
      (function() {
      var wf = document.createElement('script');
      wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
        '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
	wf.type = 'text/javascript';
	wf.async = 'true';
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(wf, s);
	})();
    </script></head><body xmlns:d="http://docbook.org/ns/docbook" bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div id="wrapper"><div class="header-wrapper"><header id="header"><ul class="header-list"><li class="header-item"><a href="http://janusgraph.org"><img src="images/janusgraph-logo.png" alt="JanusGraph" class="normal_logo"></a></li><li class="header-item-right"><a href="https://github.com/JanusGraph/janusgraph/releases">Download JanusGraph</a></li><li class="header-item-right dropdown"><a href="https://docs.janusgraph.org/latest/doc-versions.html">Other Doc Versions</a><div class="dropdown-content"><a href="https://docs.janusgraph.org/latest/index.html">Latest</a><a href="https://docs.janusgraph.org/0.3.0/index.html">Version 0.3.0</a><a href="https://docs.janusgraph.org/0.2.3/index.html">Version 0.2.3</a><a href="https://docs.janusgraph.org/0.2.2/index.html">Version 0.2.2</a><a href="https://docs.janusgraph.org/0.2.1/index.html">Version 0.2.1</a><a href="https://docs.janusgraph.org/0.2.0/index.html">Version 0.2.0</a><a href="https://docs.janusgraph.org/0.1.1/index.html">Version 0.1.1</a><a href="https://docs.janusgraph.org/0.1.0/index.html">Version 0.1.0</a></div></li><li class="header-item-right"><a href="index.html">Documentation (0.2.3)</a></li></ul></header></div><div id="main" class="clearfix width-100"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">JanusGraph Documentation</a></span> &gt; <span class="breadcrumb-link"><a href="index-backends.html">Index Backends</a></span> &gt; <span class="breadcrumb-node">Index Parameters and Full-Text Search</span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="index-parameters"></a>Chapter&nbsp;26.&nbsp;Index Parameters and Full-Text Search</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="index-parameters.html#text-search">26.1. Full-Text Search</a></span></dt><dd><dl><dt><span class="section"><a href="index-parameters.html#_full_text_search">26.1.1. Full-Text Search</a></span></dt><dt><span class="section"><a href="index-parameters.html#_string_search">26.1.2. String Search</a></span></dt><dt><span class="section"><a href="index-parameters.html#_full_text_and_string_search">26.1.3. Full text and string search</a></span></dt></dl></dd><dt><span class="section"><a href="index-parameters.html#geo-search">26.2. Geo Mapping</a></span></dt></dl></div><p>When defining a mixed index, a list of parameters can be optionally specified for each property key added to the index. These parameters control how the particular key is to be indexed. JanusGraph recognizes the following index parameters. Whether these are supported depends on the configured index backend. A particular index backend might also support custom parameters in addition to the ones listed here.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="text-search"></a>26.1.&nbsp;Full-Text Search</h2></div></div></div><p>When indexing string values, that is property keys with <code class="literal">String.class</code> data type, one has the choice to either index those as text or character strings which is controlled by the <code class="literal">mapping</code> parameter type.</p><p>When the value is indexed as text, the string is tokenized into a bag of words which allows the user to efficiently query for all matches that contain one or multiple words. This is commonly referred to as <span class="strong"><strong>full-text search</strong></span>.
When the value is indexed as a character string, the string is index "as-is" without any further analysis or tokenization. This facilitates queries looking for an exact character sequence match. This is commonly referred to as <span class="strong"><strong>string search</strong></span>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_full_text_search"></a>26.1.1.&nbsp;Full-Text Search</h3></div></div></div><p>By default, strings are indexed as text. To make this indexing option explicit, one can define a mapping when indexing a property key as text.</p><pre class="programlisting">mgmt<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>graph.openManagement<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>summary<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>mgmt.makePropertyKey<span class="hl-gremlin-func">(</span><span class="hl-string">'booksummary'</span><span class="hl-gremlin-func">)</span>.dataType<span class="hl-gremlin-func">(</span>String.class<span class="hl-gremlin-func">)</span>.make<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.buildIndex<span class="hl-gremlin-func">(</span><span class="hl-string">'booksBySummary'</span>,<span class="hl-gremlin-func"> </span>Vertex.class<span class="hl-gremlin-func">)</span>.addKey<span class="hl-gremlin-func">(</span>summary,<span class="hl-gremlin-func"> </span>Mapping.TEXT.asParameter<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span>.buildMixedIndex<span class="hl-gremlin-func">(</span><span class="hl-string">"search"</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.commit<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span></pre><p>This is identical to a standard mixed index definition with the only addition of an extra parameter that specifies the mapping in the index - in this case <code class="literal">Mapping.TEXT</code>.</p><p>When a string property is indexed as text, the string value is tokenized into a bag of tokens. The exact tokenization depends on the indexing backend and its configuration. JanusGraph&#8217;s default tokenization splits the string on non-alphanumeric characters and removes any tokens with less than 2 characters. The tokenization used by an indexing backend may differ (e.g. stop words are removed) which can lead to minor differences in how full-text search queries are handled for modifications inside a transaction and committed data in the indexing backend.</p><p>When a string property is indexed as text, only full-text search predicates are supported in graph queries by the indexing backend. Full-text search is case-insensitive.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">textContains</code>: is true if (at least) one word inside the text string matches the query string</li><li class="listitem"><code class="literal">textContainsPrefix</code>: is true if (at least) one word inside the text string begins with the query string</li><li class="listitem"><code class="literal">textContainsRegex</code>: is true if (at least) one word inside the text string matches the given regular expression</li><li class="listitem"><code class="literal">textContainsFuzzy</code>: is true if (at least) one word inside the text string is similar to the query String (based on Levenshtein edit distance)</li></ul></div><pre class="programlisting">import<span class="hl-gremlin-func"> </span>static<span class="hl-gremlin-func"> </span>org.janusgraph.core.attribute.Text.*<span class="hl-gremlin-func">
</span>g.<span class="hl-gremlin-func">V(</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">has(</span><span class="hl-string">'booksummary'</span>,<span class="hl-gremlin-func"> </span>textContains<span class="hl-gremlin-func">(</span><span class="hl-string">'unicorns'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>g.<span class="hl-gremlin-func">V(</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">has(</span><span class="hl-string">'booksummary'</span>,<span class="hl-gremlin-func"> </span>textContainsPrefix<span class="hl-gremlin-func">(</span><span class="hl-string">'uni'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>g.<span class="hl-gremlin-func">V(</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">has(</span><span class="hl-string">'booksummary'</span>,<span class="hl-gremlin-func"> </span>textContainsRegex<span class="hl-gremlin-func">(</span><span class="hl-string">'.*corn.*'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>g.<span class="hl-gremlin-func">V(</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">has(</span><span class="hl-string">'booksummary'</span>,<span class="hl-gremlin-func"> </span>textContainsFuzzy<span class="hl-gremlin-func">(</span><span class="hl-string">'unicorn'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span></pre><p>String search predicates (see below) may be used in queries, but those require filtering in memory which can be very costly.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_string_search"></a>26.1.2.&nbsp;String Search</h3></div></div></div><p>To index string properties as character sequences without any analysis or tokenization, specify the mapping as <code class="literal">Mapping.STRING</code>:</p><pre class="programlisting">mgmt<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>graph.openManagement<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>name<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>mgmt.makePropertyKey<span class="hl-gremlin-func">(</span><span class="hl-string">'bookname'</span><span class="hl-gremlin-func">)</span>.dataType<span class="hl-gremlin-func">(</span>String.class<span class="hl-gremlin-func">)</span>.make<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.buildIndex<span class="hl-gremlin-func">(</span><span class="hl-string">'booksBySummary'</span>,<span class="hl-gremlin-func"> </span>Vertex.class<span class="hl-gremlin-func">)</span>.addKey<span class="hl-gremlin-func">(</span>name,<span class="hl-gremlin-func"> </span>Mapping.STRING.asParameter<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span>.buildMixedIndex<span class="hl-gremlin-func">(</span><span class="hl-string">"search"</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.commit<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span></pre><p>When a string mapping is configured, the string value is indexed and can be queried "as-is" - including stop words and non-letter characters. However, in this case the query must match the entire string value. Hence, the string mapping is useful when indexing short character sequences that are considered to be one token.</p><p>When a string property is indexed as string, only the following predicates are supported in graph queries by the indexing backend. String search is case-sensitive.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">eq</code>: if the string is identical to the query string</li><li class="listitem"><code class="literal">neq</code>: if the string is different than the query string</li><li class="listitem"><code class="literal">textPrefix</code>: if the string value starts with the given query string</li><li class="listitem"><code class="literal">textRegex</code>: if the string value matches the given regular expression in its entirety</li><li class="listitem"><code class="literal">textFuzzy</code>: if the string value is similar to the given query string (based on Levenshtein edit distance)</li></ul></div><pre class="programlisting">import<span class="hl-gremlin-func"> </span>static<span class="hl-gremlin-func"> </span>org.apache.tinkerpop.gremlin.process.traversal.P.*<span class="hl-gremlin-func">
</span>import<span class="hl-gremlin-func"> </span>static<span class="hl-gremlin-func"> </span>org.janusgraph.core.attribute.Text.*<span class="hl-gremlin-func">
</span>g.<span class="hl-gremlin-func">V(</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">has(</span><span class="hl-string">'bookname'</span>,<span class="hl-gremlin-func"> </span>eq<span class="hl-gremlin-func">(</span><span class="hl-string">'unicorns'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>g.<span class="hl-gremlin-func">V(</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">has(</span><span class="hl-string">'bookname'</span>,<span class="hl-gremlin-func"> </span>neq<span class="hl-gremlin-func">(</span><span class="hl-string">'unicorns'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>g.<span class="hl-gremlin-func">V(</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">has(</span><span class="hl-string">'bookname'</span>,<span class="hl-gremlin-func"> </span>textPrefix<span class="hl-gremlin-func">(</span><span class="hl-string">'uni'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>g.<span class="hl-gremlin-func">V(</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">has(</span><span class="hl-string">'bookname'</span>,<span class="hl-gremlin-func"> </span>textRegex<span class="hl-gremlin-func">(</span><span class="hl-string">'.*corn.*'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>g.<span class="hl-gremlin-func">V(</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">has(</span><span class="hl-string">'bookname'</span>,<span class="hl-gremlin-func"> </span>textFuzzy<span class="hl-gremlin-func">(</span><span class="hl-string">'unicorn'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span></pre><p>Full-text search predicates may be used in queries, but those require filtering in memory which can be very costly.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_full_text_and_string_search"></a>26.1.3.&nbsp;Full text and string search</h3></div></div></div><p>If you are using Elasticsearch it is possible to index properties as both text and string allowing you to use all of the predicates for exact and fuzzy matching.</p><pre class="programlisting">mgmt<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>graph.openManagement<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>summary<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>mgmt.makePropertyKey<span class="hl-gremlin-func">(</span><span class="hl-string">'booksummary'</span><span class="hl-gremlin-func">)</span>.dataType<span class="hl-gremlin-func">(</span>String.class<span class="hl-gremlin-func">)</span>.make<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.buildIndex<span class="hl-gremlin-func">(</span><span class="hl-string">'booksBySummary'</span>,<span class="hl-gremlin-func"> </span>Vertex.class<span class="hl-gremlin-func">)</span>.addKey<span class="hl-gremlin-func">(</span>summary,<span class="hl-gremlin-func"> </span>Mapping.TEXTSTRING.asParameter<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span>.buildMixedIndex<span class="hl-gremlin-func">(</span><span class="hl-string">"search"</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.commit<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span></pre><p>Note that the data will be stored in the index twice, once for exact matching and once for fuzzy matching.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="geo-search"></a>26.2.&nbsp;Geo Mapping</h2></div></div></div><p>By default, JanusGraph supports indexing geo properties with point type and querying geo properties by circle or box. To index a non-point geo property with support for querying by any geoshape type, specify the mapping as <code class="literal">Mapping.PREFIX_TREE</code>:</p><pre class="programlisting">mgmt<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>graph.openManagement<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>name<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>mgmt.makePropertyKey<span class="hl-gremlin-func">(</span><span class="hl-string">'border'</span><span class="hl-gremlin-func">)</span>.dataType<span class="hl-gremlin-func">(</span>Geoshape.class<span class="hl-gremlin-func">)</span>.make<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.buildIndex<span class="hl-gremlin-func">(</span><span class="hl-string">'borderIndex'</span>,<span class="hl-gremlin-func"> </span>Vertex.class<span class="hl-gremlin-func">)</span>.addKey<span class="hl-gremlin-func">(</span>name,<span class="hl-gremlin-func"> </span>Mapping.PREFIX_TREE.asParameter<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span>.buildMixedIndex<span class="hl-gremlin-func">(</span><span class="hl-string">"search"</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.commit<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span></pre><p>Additional parameters can be specified to tune the configuration of the underlying prefix tree mapping. These optional parameters include the number of levels used in the prefix tree as well as the associated precision.</p><pre class="programlisting">mgmt<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>graph.openManagement<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>name<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>mgmt.makePropertyKey<span class="hl-gremlin-func">(</span><span class="hl-string">'border'</span><span class="hl-gremlin-func">)</span>.dataType<span class="hl-gremlin-func">(</span>Geoshape.class<span class="hl-gremlin-func">)</span>.make<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.buildIndex<span class="hl-gremlin-func">(</span><span class="hl-string">'borderIndex'</span>,<span class="hl-gremlin-func"> </span>Vertex.class<span class="hl-gremlin-func">)</span>.addKey<span class="hl-gremlin-func">(</span>name,<span class="hl-gremlin-func"> </span>Mapping.PREFIX_TREE.asParameter<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span>,<span class="hl-gremlin-func"> </span>Parameter.of<span class="hl-gremlin-func">(</span><span class="hl-string">"index-geo-max-levels"</span>,<span class="hl-gremlin-func"> </span><span class="hl-number">18</span><span class="hl-gremlin-func">)</span>,<span class="hl-gremlin-func"> </span>Parameter.of<span class="hl-gremlin-func">(</span><span class="hl-string">"index-geo-dist-error-pct"</span>,<span class="hl-gremlin-func"> </span><span class="hl-number">0.0125</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span>.buildMixedIndex<span class="hl-gremlin-func">(</span><span class="hl-string">"search"</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.commit<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span></pre><p>Note that some indexing backends (e.g. Solr) may require additional external schema configuration to support and tune indexing non-point properties.</p></div></div></div><div class="clearer"></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="search-predicates.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index-backends.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="field-mapping.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;25.&nbsp;Search Predicates and Data Types&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;27.&nbsp;Field Mapping</td></tr></table></div><div class="footer-wrapper"><footer id="footer"><div class="copyright">
              Copyright &copy; 2017 JanusGraph Authors. All rights reserved.<br>
              The Linux Foundation has registered trademarks and uses trademarks. For a list of<br>
              trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage">Trademark Usage</a> page.<br>
              Cassandra, Groovy, HBase, Hadoop, Lucene, Solr, and TinkerPop are trademarks of the Apache Software Foundation.<br>
              Berkeley DB and Berkeley DB Java Edition are trademarks of Oracle.<br>
              Documentation generated with <a href="http://www.methods.co.nz/asciidoc/">AsciiDoc</a>, <a href="http://asciidoctor.org/">AsciiDoctor</a>, <a href="http://docbook.sourceforge.net/">DocBook</a>, and <a href="http://saxon.sourceforge.net/">Saxon</a>.
        	  </div></footer></div></div></body></html>