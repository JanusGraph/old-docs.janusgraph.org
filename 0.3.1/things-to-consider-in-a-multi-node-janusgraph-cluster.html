<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;10.&nbsp;Things to Consider in a Multi-Node JanusGraph Cluster</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="JanusGraph Documentation"><link rel="up" href="basics.html" title="Part&nbsp;II.&nbsp;JanusGraph Basics"><link rel="prev" href="configuredgraphfactory.html" title="Chapter&nbsp;9.&nbsp;ConfiguredGraphFactory"><link rel="next" href="indexes.html" title="Chapter&nbsp;11.&nbsp;Indexing for Better Performance"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-1.11.0.js"></script><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-migrate-1.2.1.min.js"></script><link xmlns:d="http://docbook.org/ns/docbook" rel="stylesheet" id="inline-blob-janusgraph-docs-specific" href="css/docs.css" type="text/css" media="all"><link xmlns:d="http://docbook.org/ns/docbook" rel="apple-touch-icon" type="image/png" href="images/janusgraph-logomark.png"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript">
      WebFontConfig = {
        google: {
          families: [
            "Lato:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Open+Sans:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Antic+Slab:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese"
          ]
        }
      };
      (function() {
      var wf = document.createElement('script');
      wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
        '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
	wf.type = 'text/javascript';
	wf.async = 'true';
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(wf, s);
	})();
    </script></head><body xmlns:d="http://docbook.org/ns/docbook" bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div id="wrapper"><div class="header-wrapper"><header id="header"><ul class="header-list"><li class="header-item"><a href="http://janusgraph.org"><img src="images/janusgraph-logo.png" alt="JanusGraph" class="normal_logo"></a></li><li class="header-item-right"><a href="https://github.com/JanusGraph/janusgraph/releases">Download JanusGraph</a></li><li class="header-item-right dropdown"><a href="https://docs.janusgraph.org/latest/doc-versions.html">Other Doc Versions</a><div class="dropdown-content"><a href="https://docs.janusgraph.org/latest/index.html">Latest</a><a href="https://docs.janusgraph.org/0.3.1/index.html">Version 0.3.1</a><a href="https://docs.janusgraph.org/0.3.0/index.html">Version 0.3.0</a><a href="https://docs.janusgraph.org/0.2.2/index.html">Version 0.2.2</a><a href="https://docs.janusgraph.org/0.2.1/index.html">Version 0.2.1</a><a href="https://docs.janusgraph.org/0.2.0/index.html">Version 0.2.0</a><a href="https://docs.janusgraph.org/0.1.1/index.html">Version 0.1.1</a><a href="https://docs.janusgraph.org/0.1.0/index.html">Version 0.1.0</a></div></li><li class="header-item-right"><a href="index.html">Documentation (0.3.1)</a></li></ul></header></div><div id="main" class="clearfix width-100"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">JanusGraph Documentation</a></span> &gt; <span class="breadcrumb-link"><a href="basics.html">JanusGraph Basics</a></span> &gt; <span class="breadcrumb-node">Things to Consider in a Multi-Node JanusGraph Cluster</span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="things-to-consider-in-a-multi-node-janusgraph-cluster"></a>Chapter&nbsp;10.&nbsp;Things to Consider in a Multi-Node JanusGraph Cluster</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="things-to-consider-in-a-multi-node-janusgraph-cluster.html#dynamic-graphs">10.1. Dynamic Graphs</a></span></dt><dd><dl><dt><span class="section"><a href="things-to-consider-in-a-multi-node-janusgraph-cluster.html#graph-reference-consistency">10.1.1. Graph Reference Consistency</a></span></dt><dt><span class="section"><a href="things-to-consider-in-a-multi-node-janusgraph-cluster.html#dynamic-graph-and-traversal-bindings">10.1.2. Dynamic Graph and Traversal Bindings</a></span></dt></dl></dd></dl></div><p>JanusGraph is a distributed graph database, which means it can be setup in a multi-node cluster. However, when working in such an environment, there are important things to consider. Furthermore, if configured properly, JanusGraph handles some of these special considerations for the user.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dynamic-graphs"></a>10.1.&nbsp;Dynamic Graphs</h2></div></div></div><p>JanusGraph supports <a class="link" href="configuredgraphfactory.html" title="Chapter&nbsp;9.&nbsp;ConfiguredGraphFactory">dynamically creating graphs</a>. This is deviation from the way in which standard Gremlin Server implementations allow one to access a graph. Traditionally, users create bindings to graphs at server-start, by configuring the gremlin-server.yaml file accordingly. For example, if the <code class="literal">graphs</code> section of your yaml file looks like this:</p><pre class="programlisting">graphs {
<span class="hl-attribute">  graph1</span>: conf/graph1.properties,
<span class="hl-attribute">  graph2</span>: conf/graph2.properties
}</pre><p>then you will access your graphs on the Gremlin Server using the fact that the String <code class="literal">graph1</code> will be bound to the graph opened on the server as per its supplied properties file, and the same holds true for <code class="literal">graph2</code>.</p><p>However, if we use the <code class="literal">ConfiguredGraphFactory</code> to dynamically create graphs, then those graphs are managed by the <a class="link" href="configuredgraphfactory.html#JanusGraphmanager" title="9.9.&nbsp;JanusGraphManager">JanusGraphManager</a> and the graph configurations are managed by the <a class="link" href="configuredgraphfactory.html#configurationmanagementgraph" title="9.8.&nbsp;ConfigurationManagementGraph">ConfigurationManagementGraph</a>. This is especially useful because it 1. allows you to define graph configurations post-server-start and 2. allows the graph configurations to be managed in a persisted and distributed nature across your JanusGraph cluster.</p><p>To properly use the <code class="literal">ConfiguredGraphFactory</code>, you must configure every Gremlin Server in your cluster to use the <code class="literal">JanusGraphManager</code> and the <code class="literal">ConfigurationManagementGraph</code>. This procedure is explained in detail <a class="link" href="configuredgraphfactory.html#configuring-JanusGraph-server-for-configuredgraphfactory" title="9.7.&nbsp;Configuring JanusGraph Server for ConfiguredGraphFactory">here</a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="graph-reference-consistency"></a>10.1.1.&nbsp;Graph Reference Consistency</h3></div></div></div><p>If you configure all your JanusGraph servers to use the <a class="link" href="configuredgraphfactory.html#configuring-JanusGraph-server-for-configuredgraphfactory" title="9.7.&nbsp;Configuring JanusGraph Server for ConfiguredGraphFactory">ConfiguredGraphFactory</a>, JanusGraph will ensure all graph representations are-up-to-date across all JanusGraph nodes in your cluster.</p><p>For example, if you update or delete the configuration to a graph on one JanusGraph node, then we must evict that graph from the cache on <span class="emphasis"><em>every JanusGraph node in the cluster</em></span>. Otherwise, we may have inconsistent graph representations across your cluster. JanusGraph automatically handles this eviction using a messaging log queue through the backend system that the graph in question is configured to use.</p><p>If one of your servers is configured incorrectly, then it may not be able to successfully remove the graph from the cache.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/icons/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Any updates to your <a class="link" href="configuredgraphfactory.html#template-configuration" title="9.8.2.&nbsp;Template Configuration">TemplateConfiguration</a> will not result in the updating of graphs/graph configurations previously created using said template configuration. If you want to update the individual graph configurations, you must do so using the <a class="link" href="configuredgraphfactory.html#updating-configurations" title="9.8.3.&nbsp;Updating Configurations">available update APIs</a>. These update APIs will <span class="emphasis"><em>then</em></span> result in the graphe cache eviction across all JanusGraph nodes in your cluster.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-graph-and-traversal-bindings"></a>10.1.2.&nbsp;Dynamic Graph and Traversal Bindings</h3></div></div></div><p>JanusGraph has the ability to bind dynamically created graphs and their traversal references to <code class="literal">&lt;graph.graphname&gt;</code> and <code class="literal">&lt;graph.graphname&gt;_traversal</code>, respectively, across all JanusGraph nodes in your cluster, with a maximum of a 20s lag for the binding to take effect on any node in the cluster. Read more about this <a class="link" href="configuredgraphfactory.html#graph-and-traversal-bindings" title="9.10.&nbsp;Graph and Traversal Bindings">here</a>.</p><p>JanusGraph accomplishes this by having each node in your cluster poll the <code class="literal">ConfigurationManagementGraph</code> for all graphs for which you have created configurations. The <code class="literal">JanusGraphManager</code> will then open said graph with its persisted configuration, store it in its graph cache, and bind the <code class="literal">&lt;graph.graphname&gt;</code> to the graph reference on the <code class="literal">GremlinExecutor</code> as well as bind <code class="literal">&lt;graph.graphname&gt;_traversal</code> to the graph&#8217;s traversal reference on the <code class="literal">GremlinExecutor</code>.</p><p>This allows you to access a dynamically created graph and its traversal reference by their string bindings, on every node in your JanusGraph cluster. This is particularly important to be able to work with Gremlin Server clients and use <a class="link" href="things-to-consider-in-a-multi-node-janusgraph-cluster.html#tinkerpop-with-remote" title="10.1.2.2.&nbsp;Using TinkerPop&#8217;s withRemote Functionality">TinkerPops&#8217;s withRemote functionality</a>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="set-up"></a>10.1.2.1.&nbsp;Set Up</h4></div></div></div><p>To set up your cluster to bind dynamically created graphs and their traversal references, you must:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Configure each node to use the <a class="link" href="configuredgraphfactory.html#configuring-JanusGraph-server-for-configuredgraphfactory" title="9.7.&nbsp;Configuring JanusGraph Server for ConfiguredGraphFactory">ConfiguredGraphFactory</a>.</li><li class="listitem">Configure each node to use a <code class="literal">JanusGraphChannelizer</code>, which injects lower-level Gremlin Server components, like the GremlinExecutor, into the JanusGraph project, giving us greater control of the Gremlin Server.</li></ol></div><p>To configure each node to use a <code class="literal">JanusGraphChannelizer</code>, we must update the <code class="literal">gremlin-server.yaml</code> to do so:</p><pre class="programlisting"><span class="hl-attribute">channelizer</span>: org.janusgraph.channelizers.JanusGraphWebSocketChannelizer</pre><p>There are a few channelizers you can choose from:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">org.janusgraph.channelizers.JanusGraphWebSocketChannelizer</li><li class="listitem">org.janusgraph.channelizers.JanusGraphHttpChannelizer</li><li class="listitem">org.janusgraph.channelizers.JanusGraphNioChannelizer</li><li class="listitem">org.janusgraph.channelizers.JanusGraphWsAndHttpChannelizer</li></ol></div><p>All of the channelizers share the exact same functionality as their TinkerPop counterparts.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="tinkerpop-with-remote"></a>10.1.2.2.&nbsp;Using TinkerPop&#8217;s withRemote Functionality</h4></div></div></div><p>Since traversal references are bound on the JanusGraph servers, we can make use of <a class="link" href="http://tinkerpop.apache.org/docs/current/reference/#connecting-via-remotegraph" target="_top">TinkerPop&#8217;s withRemote functionality</a>. This will allow one to run gremlin queries locally, against a remote graph reference. Traditionally, one runs queries against remote Gremlin Servers by sending String script representations, which are processed on the remote server and the response serialized and sent back. However, TinkerPop also allows for the use of <code class="literal">remoteGraph</code>, which could be useful if you are building a TinkerPop compliant graph infrastructure that is easily transferable to multiple implementations.</p><p>To use this functionality in JanusGraph, we must first ensure we have created a graph on the remote JanusGraph cluster:</p><pre class="screen">ConfiguredGraphFactory.create("graph1");</pre><p>Next, we must wait 20 seconds to ensure the traversal reference is bound on every JanusGraph node in the remote cluster.</p><p>Finally, we can locally make use of the <code class="literal">withRemote</code> method to access a local reference to a remote graph:</p><pre class="programlisting"><span class="hl-repl-prompt">gremlin&gt;</span><span class="hl-gremlin-func"> </span>cluster<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>Cluster.open<span class="hl-gremlin-func">(</span><span class="hl-string">'conf/remote-objects.yaml'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span><span class="hl-repl-result">==&gt;</span>localhost/<span class="hl-number">127.0</span>.<span class="hl-number">0.1</span>:<span class="hl-number">8182</span><span class="hl-gremlin-func">
</span><span class="hl-repl-prompt">gremlin&gt;</span><span class="hl-gremlin-func"> </span>graph<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>EmptyGraph.instance<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span><span class="hl-repl-result">==&gt;</span>emptygraph[empty]<span class="hl-gremlin-func">
</span><span class="hl-repl-prompt">gremlin&gt;</span><span class="hl-gremlin-func"> </span>g<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>graph.traversal<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span>.withRemote<span class="hl-gremlin-func">(</span>DriverRemoteConnection.using<span class="hl-gremlin-func">(</span>cluster,<span class="hl-gremlin-func"> </span><span class="hl-string">"graph1_traversal"</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span><span class="hl-repl-result">==&gt;</span>graphtraversalsource[emptygraph[empty],<span class="hl-gremlin-func"> </span>standard]</pre><p>For completion, the above <code class="literal">conf/remote-objects.yaml</code> should tell the <code class="literal">Cluster</code> API how to access the remote JanusGraph servers; for example, it may look like:</p><pre class="programlisting"><span class="hl-attribute">hosts</span>: [remoteaddress1.com, remoteaddress2.com]
<span class="hl-attribute">port</span>: 8182
<span class="hl-attribute">username</span>: admin
<span class="hl-attribute">password</span>: password
<span class="hl-attribute">connectionPool: { enableSsl</span>: true }
<span class="hl-attribute">serializer: { className: org.apache.tinkerpop.gremlin.driver.ser.GryoMessageSerializerV3d0, config: { ioRegistries</span>: [org.janusgraph.graphdb.tinkerpop.JanusGraphIoRegistry] }}</pre></div></div></div></div></div><div class="clearer"></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="configuredgraphfactory.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="basics.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="indexes.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;9.&nbsp;ConfiguredGraphFactory&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;11.&nbsp;Indexing for Better Performance</td></tr></table></div><div class="footer-wrapper"><footer id="footer"><div class="copyright">
              Copyright &copy; 2017 JanusGraph Authors. All rights reserved.<br>
              The Linux Foundation has registered trademarks and uses trademarks. For a list of<br>
              trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage">Trademark Usage</a> page.<br>
              Cassandra, Groovy, HBase, Hadoop, Lucene, Solr, and TinkerPop are trademarks of the Apache Software Foundation.<br>
              Berkeley DB and Berkeley DB Java Edition are trademarks of Oracle.<br>
              Documentation generated with <a href="http://www.methods.co.nz/asciidoc/">AsciiDoc</a>, <a href="http://asciidoctor.org/">AsciiDoctor</a>, <a href="http://docbook.sourceforge.net/">DocBook</a>, and <a href="http://saxon.sourceforge.net/">Saxon</a>.
        	  </div></footer></div></div></body></html>