<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;14.&nbsp;Transaction Log</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="JanusGraph Documentation"><link rel="up" href="basics.html" title="Part&nbsp;II.&nbsp;JanusGraph Basics"><link rel="prev" href="caching.html" title="Chapter&nbsp;13.&nbsp;JanusGraph Cache"><link rel="next" href="config-ref.html" title="Chapter&nbsp;15.&nbsp;Configuration Reference"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-1.11.0.js"></script><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-migrate-1.2.1.min.js"></script><link xmlns:d="http://docbook.org/ns/docbook" rel="stylesheet" id="inline-blob-janusgraph-docs-specific" href="css/docs.css" type="text/css" media="all"><link xmlns:d="http://docbook.org/ns/docbook" rel="apple-touch-icon" type="image/png" href="images/janusgraph-logomark.png"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript">
      WebFontConfig = {
        google: {
          families: [
            "Lato:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Open+Sans:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Antic+Slab:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese"
          ]
        }
      };
      (function() {
      var wf = document.createElement('script');
      wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
        '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
	wf.type = 'text/javascript';
	wf.async = 'true';
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(wf, s);
	})();
    </script></head><body xmlns:d="http://docbook.org/ns/docbook" bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div id="wrapper"><div class="header-wrapper"><header id="header"><ul class="header-list"><li class="header-item"><a href="http://janusgraph.org"><img src="images/janusgraph-logo.png" alt="JanusGraph" class="normal_logo"></a></li><li class="header-item-right"><a href="https://github.com/JanusGraph/janusgraph/releases">Download JanusGraph</a></li><li class="header-item-right dropdown"><a href="https://docs.janusgraph.org/latest/doc-versions.html">Other Doc Versions</a><div class="dropdown-content"><a href="https://docs.janusgraph.org/latest/index.html">Latest</a><a href="https://docs.janusgraph.org/0.3.1/index.html">Version 0.3.1</a><a href="https://docs.janusgraph.org/0.3.0/index.html">Version 0.3.0</a><a href="https://docs.janusgraph.org/0.2.2/index.html">Version 0.2.2</a><a href="https://docs.janusgraph.org/0.2.1/index.html">Version 0.2.1</a><a href="https://docs.janusgraph.org/0.2.0/index.html">Version 0.2.0</a><a href="https://docs.janusgraph.org/0.1.1/index.html">Version 0.1.1</a><a href="https://docs.janusgraph.org/0.1.0/index.html">Version 0.1.0</a></div></li><li class="header-item-right"><a href="index.html">Documentation (0.3.1)</a></li></ul></header></div><div id="main" class="clearfix width-100"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">JanusGraph Documentation</a></span> &gt; <span class="breadcrumb-link"><a href="basics.html">JanusGraph Basics</a></span> &gt; <span class="breadcrumb-node">Transaction Log</span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="log"></a>Chapter&nbsp;14.&nbsp;Transaction Log</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="log.html#_transaction_log_use_cases">14.1. Transaction Log Use Cases</a></span></dt><dd><dl><dt><span class="section"><a href="log.html#_record_of_change">14.1.1. Record of Change</a></span></dt><dt><span class="section"><a href="log.html#_downstream_updates">14.1.2. Downstream Updates</a></span></dt><dt><span class="section"><a href="log.html#_triggers">14.1.3. Triggers</a></span></dt></dl></dd><dt><span class="section"><a href="log.html#_log_configuration">14.2. Log Configuration</a></span></dt></dl></div><p>JanusGraph can automatically log transactional changes for additional processing or as a record of change. To enable logging for a particular transaction, specify the name of the target log during the start of the transaction.</p><pre class="programlisting">tx<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>graph.buildTransaction<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span>.logIdentifier<span class="hl-gremlin-func">(</span><span class="hl-string">'addedPerson'</span><span class="hl-gremlin-func">)</span>.start<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>u<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>tx.<span class="hl-gremlin-func">addVertex(</span>label,<span class="hl-gremlin-func"> </span><span class="hl-string">'human'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>u.property<span class="hl-gremlin-func">(</span><span class="hl-string">'name'</span>,<span class="hl-gremlin-func"> </span><span class="hl-string">'proteros'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>u.property<span class="hl-gremlin-func">(</span><span class="hl-string">'age'</span>,<span class="hl-gremlin-func"> </span><span class="hl-number">36</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>tx.commit<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span></pre><p>Upon commit, any changes made during the transaction are logged to the user logging system into a log named <code class="literal">addedPerson</code>. The <span class="strong"><strong>user logging system</strong></span> is a configurable logging backend with a JanusGraph compatible log interface. By default, the log is written to a separate store in the primary storage backend which can be configured as described below. The log identifier specified during the start of the transaction identifies the log in which the changes are recorded thereby allowing different types of changes to be recorded in separate logs for individual processing.</p><pre class="programlisting">tx<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>graph.buildTransaction<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span>.logIdentifier<span class="hl-gremlin-func">(</span><span class="hl-string">'battle'</span><span class="hl-gremlin-func">)</span>.start<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>h<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>tx.traversal<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">V(</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">has(</span><span class="hl-string">'name'</span>,<span class="hl-gremlin-func"> </span><span class="hl-string">'hercules'</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">next(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>m<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>tx.<span class="hl-gremlin-func">addVertex(</span>label,<span class="hl-gremlin-func"> </span><span class="hl-string">'monster'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>m.property<span class="hl-gremlin-func">(</span><span class="hl-string">'name'</span>,<span class="hl-gremlin-func"> </span><span class="hl-string">'phylatax'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>h.<span class="hl-gremlin-func">addEdge(</span><span class="hl-string">'battled'</span>,<span class="hl-gremlin-func"> </span>m,<span class="hl-gremlin-func"> </span><span class="hl-string">'time'</span>,<span class="hl-gremlin-func"> </span><span class="hl-number">22</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>tx.commit<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span></pre><p>JanusGraph provides a user transaction log processor framework to process the recorded transactional changes. The transaction log processor is opened via <code class="literal">JanusGraphFactory.openTransactionLog(JanusGraph)</code> against a previously opened JanusGraph graph instance. One can then add processors for a particular log which holds transactional changes.</p><pre class="programlisting">import<span class="hl-gremlin-func"> </span>java.util.concurrent.atomic.*;<span class="hl-gremlin-func">
</span>import<span class="hl-gremlin-func"> </span>org.janusgraph.core.log.*;<span class="hl-gremlin-func">
</span>import<span class="hl-gremlin-func"> </span>java.util.concurrent.*;<span class="hl-gremlin-func">
</span>logProcess<span class="hl-gremlin-func">or </span>=<span class="hl-gremlin-func"> </span>JanusGraphFactory.openTransactionLog<span class="hl-gremlin-func">(</span>g<span class="hl-gremlin-func">)</span>;<span class="hl-gremlin-func">
</span>totalHumansAdded<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>new<span class="hl-gremlin-func"> </span>AtomicInteger<span class="hl-gremlin-func">(</span><span class="hl-number">0</span><span class="hl-gremlin-func">)</span>;<span class="hl-gremlin-func">
</span>totalGodsAdded<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>new<span class="hl-gremlin-func"> </span>AtomicInteger<span class="hl-gremlin-func">(</span><span class="hl-number">0</span><span class="hl-gremlin-func">)</span>;<span class="hl-gremlin-func">
</span>logProcessor.addLogProcess<span class="hl-gremlin-func">or(</span><span class="hl-string">"addedPerson"</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>setProcessorIdentifier<span class="hl-gremlin-func">(</span><span class="hl-string">"addedPersonCounter"</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>setStartTimeNow<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>addProcess<span class="hl-gremlin-func">or(</span>new<span class="hl-gremlin-func"> </span>ChangeProcess<span class="hl-gremlin-func">or(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func"> </span>{<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>@Override<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>public<span class="hl-gremlin-func"> </span>vo<span class="hl-gremlin-func">id </span>process<span class="hl-gremlin-func">(</span>JanusGraphTransaction<span class="hl-gremlin-func"> </span>tx,<span class="hl-gremlin-func"> </span>TransactionId<span class="hl-gremlin-func"> </span>txId,<span class="hl-gremlin-func"> </span>ChangeState<span class="hl-gremlin-func"> </span>changeState<span class="hl-gremlin-func">)</span><span class="hl-gremlin-func"> </span>{<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>f<span class="hl-gremlin-func">or </span><span class="hl-gremlin-func">(</span>v<span class="hl-gremlin-func"> </span><span class="hl-gremlin-func">in </span>changeState.getVertices<span class="hl-gremlin-func">(</span>Change.ADDED<span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func"> </span>{<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>if<span class="hl-gremlin-func"> </span><span class="hl-gremlin-func">(</span>v.<span class="hl-gremlin-func">label(</span><span class="hl-gremlin-func">)</span>.equals<span class="hl-gremlin-func">(</span><span class="hl-string">"human"</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func"> </span>totalHumansAdded.incrementAndGet<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span>;<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>}<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>}<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>}<span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>addProcess<span class="hl-gremlin-func">or(</span>new<span class="hl-gremlin-func"> </span>ChangeProcess<span class="hl-gremlin-func">or(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func"> </span>{<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>@Override<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>public<span class="hl-gremlin-func"> </span>vo<span class="hl-gremlin-func">id </span>process<span class="hl-gremlin-func">(</span>JanusGraphTransaction<span class="hl-gremlin-func"> </span>tx,<span class="hl-gremlin-func"> </span>TransactionId<span class="hl-gremlin-func"> </span>txId,<span class="hl-gremlin-func"> </span>ChangeState<span class="hl-gremlin-func"> </span>changeState<span class="hl-gremlin-func">)</span><span class="hl-gremlin-func"> </span>{<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>f<span class="hl-gremlin-func">or </span><span class="hl-gremlin-func">(</span>v<span class="hl-gremlin-func"> </span><span class="hl-gremlin-func">in </span>changeState.getVertices<span class="hl-gremlin-func">(</span>Change.ADDED<span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func"> </span>{<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>if<span class="hl-gremlin-func"> </span><span class="hl-gremlin-func">(</span>v.<span class="hl-gremlin-func">label(</span><span class="hl-gremlin-func">)</span>.equals<span class="hl-gremlin-func">(</span><span class="hl-string">"god"</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func"> </span>totalGodsAdded.incrementAndGet<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span>;<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>}<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>}<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>}<span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>build<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span>;</pre><p>In this example, a <span class="strong"><strong>log processor</strong></span> is built for the user transaction log named <code class="literal">addedPerson</code> to process the changes made in transactions which used the <code class="literal">addedPerson</code> log identifier. Two <span class="strong"><strong>change processors</strong></span> are added to this log processor. The first processor counts the number of humans added and the second counts the number of gods added to the graph.</p><p>When a log processor is built against a particular log, such as the <code class="literal">addedPerson</code> log in the example above, it will start reading transactional change records from the log immediately upon successful construction and initialization up to the head of the log. The start time specified in the builder marks the time point in the log where the log processor will start reading records. Optionally, one can specify an identifier for the log processor in the builder. The log processor will use the identifier to regularly persist its state of processing, i.e. it will maintain a marker on the last read log record. If the log processor is later restarted with the same identifier, it will continue reading from the last read record. This is particularly useful when the log processor is supposed to run for long periods of time and is therefore likely to fail. In such failure situations, the log processor can simply be restarted with the same identifier.
It must be ensured that log processor identifiers are unique in a JanusGraph cluster in order to avoid conflicts on the persisted read markers.</p><p>A change processor must implement the <code class="literal">ChangeProcessor</code> interface. It&#8217;s <code class="literal">process()</code> method is invoked for each change record read from the log with a <code class="literal">JanusGraphTransaction</code> handle, the id of the transaction that caused the change, and a <code class="literal">ChangeState</code> container which holds the transactional changes. The change state container can be queried to retrieve individual elements that were part of the change state. In the example, all added vertices are retrieved. Refer to the API documentation for a description of all the query methods on <code class="literal">ChangeState</code>. The provided transaction id can be used to investigate the origin of the transaction which is uniquely identified by the combination of the id of the JanusGraph instance that executed the transaction (<code class="literal">txId.getInstanceId()</code>) and the instance specific transaction id (<code class="literal">txId.getTransactionId()</code>). In addition, the time of the transaction is available through <code class="literal">txId.getTransactionTime()</code>.</p><p>Change processors are executed individually and in multiple threads. If a change processor accesses global state it must be ensured that such state allows concurrent access. While the log processor reads log records sequentially, the changes are processed in multiple threads so it cannot be guaranteed that the log order is preserved in the change processors.</p><p>Note, that log processors run each registered change processor at least once for each record in the log which means that a single transactional change record may be processed multiple times under certain failure conditions.
One cannot add or remove change processor from a running log processor. In other words, a log processor is immutable after it is built. To change log processing, start a new log processor and shut down an existing one.</p><pre class="programlisting">logProcessor.addLogProcess<span class="hl-gremlin-func">or(</span><span class="hl-string">"battle"</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>setProcessorIdentifier<span class="hl-gremlin-func">(</span><span class="hl-string">"battleTimer"</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>setStartTimeNow<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>addProcess<span class="hl-gremlin-func">or(</span>new<span class="hl-gremlin-func"> </span>ChangeProcess<span class="hl-gremlin-func">or(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func"> </span>{<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>@Override<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>public<span class="hl-gremlin-func"> </span>vo<span class="hl-gremlin-func">id </span>process<span class="hl-gremlin-func">(</span>JanusGraphTransaction<span class="hl-gremlin-func"> </span>tx,<span class="hl-gremlin-func"> </span>TransactionId<span class="hl-gremlin-func"> </span>txId,<span class="hl-gremlin-func"> </span>ChangeState<span class="hl-gremlin-func"> </span>changeState<span class="hl-gremlin-func">)</span><span class="hl-gremlin-func"> </span>{<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>h<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>tx.<span class="hl-gremlin-func">V(</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">has(</span><span class="hl-string">"name"</span>,<span class="hl-gremlin-func"> </span><span class="hl-string">"hercules"</span><span class="hl-gremlin-func">)</span>.toList<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span>.iterat<span class="hl-gremlin-func">or(</span><span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">next(</span><span class="hl-gremlin-func">)</span>;<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>f<span class="hl-gremlin-func">or </span><span class="hl-gremlin-func">(</span>edge<span class="hl-gremlin-func"> </span><span class="hl-gremlin-func">in </span>changeState.getEdges<span class="hl-gremlin-func">(</span>h,<span class="hl-gremlin-func"> </span>Change.ADDED,<span class="hl-gremlin-func"> </span>Direction.OUT,<span class="hl-gremlin-func"> </span><span class="hl-string">"battled"</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func"> </span>{<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>if<span class="hl-gremlin-func"> </span><span class="hl-gremlin-func">(</span>edge.&lt;Integer&gt;value<span class="hl-gremlin-func">(</span><span class="hl-string">"time"</span><span class="hl-gremlin-func">)</span>&gt;<span class="hl-number">1000</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>h.property<span class="hl-gremlin-func">(</span><span class="hl-string">"oldFighter"</span>,<span class="hl-gremlin-func"> </span>true<span class="hl-gremlin-func">)</span>;<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>}<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>}<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>}<span class="hl-gremlin-func">)</span>.<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>build<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span>;</pre><p>The log processor above processes transactions for the <code class="literal">battle</code> log identifier with a single change processor which evaluates <code class="literal">battled</code> edges that were added to Hercules. This example demonstrates that the transaction handle passed into the change processor is a normal <code class="literal">JanusGraphTransaction</code> which query the JanusGraph graph and make changes to it.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_transaction_log_use_cases"></a>14.1.&nbsp;Transaction Log Use Cases</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_record_of_change"></a>14.1.1.&nbsp;Record of Change</h3></div></div></div><p>The user transaction log can be used to keep a record of all changes made against the graph. By using separate log identifiers, changes can be recorded in different logs to distinguish separate transaction types.</p><p>At any time, a log processor can be built which can processes all recorded changes starting from the desired start time. This can be used for forensic analysis, to replay changes against a different graph, or to compute an aggregate.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_downstream_updates"></a>14.1.2.&nbsp;Downstream Updates</h3></div></div></div><p>It is often the case that a JanusGraph graph cluster is part of a larger architecture. The user transaction log and the log processor framework provide the tools needed to broadcast changes to other components of the overall system without slowing down the original transactions causing the change. This is particularly useful when transaction latencies need to be low and/or there are a number of other systems that need to be alerted to a change in the graph.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_triggers"></a>14.1.3.&nbsp;Triggers</h3></div></div></div><p>The user transaction log provides the basic infrastructure to implement triggers that can scale to a large number of concurrent transactions and very large graphs. A trigger is registered with a particular change of data and either triggers an event in an external system or additional changes to the graph. At scale, it is not advisable to implement triggers in the original transaction but rather process triggers with a slight delay through the log processor framework. The second example shows how changes to the graph can be evaluated and trigger additional modifications.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_log_configuration"></a>14.2.&nbsp;Log Configuration</h2></div></div></div><p>There are a number of configuration options to fine tune how the log processor reads from the log. Refer to the complete list of configuration options <a class="xref" href="config-ref.html" title="Chapter&nbsp;15.&nbsp;Configuration Reference">Chapter&nbsp;15, <i>Configuration Reference</i></a> for the options under the <code class="literal">log</code> namespace. To configure the user transaction log, use the <code class="literal">log.user</code> namespace. The options listed there allow the configuration of the number of threads to be used, the number of log records read in each batch, the read interval, and whether the transaction change records should automatically expire and be removed from the log after a configurable amount of time (TTL).</p></div></div></div><div class="clearer"></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="caching.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="basics.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="config-ref.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;13.&nbsp;JanusGraph Cache&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;15.&nbsp;Configuration Reference</td></tr></table></div><div class="footer-wrapper"><footer id="footer"><div class="copyright">
              Copyright &copy; 2017 JanusGraph Authors. All rights reserved.<br>
              The Linux Foundation has registered trademarks and uses trademarks. For a list of<br>
              trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage">Trademark Usage</a> page.<br>
              Cassandra, Groovy, HBase, Hadoop, Lucene, Solr, and TinkerPop are trademarks of the Apache Software Foundation.<br>
              Berkeley DB and Berkeley DB Java Edition are trademarks of Oracle.<br>
              Documentation generated with <a href="http://www.methods.co.nz/asciidoc/">AsciiDoc</a>, <a href="http://asciidoctor.org/">AsciiDoctor</a>, <a href="http://docbook.sourceforge.net/">DocBook</a>, and <a href="http://saxon.sourceforge.net/">Saxon</a>.
        	  </div></footer></div></div></body></html>