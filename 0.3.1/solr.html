<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;28.&nbsp;Apache Solr</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="JanusGraph Documentation"><link rel="up" href="index-backends.html" title="Part&nbsp;IV.&nbsp;Index Backends"><link rel="prev" href="elasticsearch.html" title="Chapter&nbsp;27.&nbsp;Elasticsearch"><link rel="next" href="lucene.html" title="Chapter&nbsp;29.&nbsp;Apache Lucene"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-1.11.0.js"></script><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-migrate-1.2.1.min.js"></script><link xmlns:d="http://docbook.org/ns/docbook" rel="stylesheet" id="inline-blob-janusgraph-docs-specific" href="css/docs.css" type="text/css" media="all"><link xmlns:d="http://docbook.org/ns/docbook" rel="apple-touch-icon" type="image/png" href="images/janusgraph-logomark.png"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript">
      WebFontConfig = {
        google: {
          families: [
            "Lato:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Open+Sans:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Antic+Slab:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese"
          ]
        }
      };
      (function() {
      var wf = document.createElement('script');
      wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
        '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
	wf.type = 'text/javascript';
	wf.async = 'true';
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(wf, s);
	})();
    </script></head><body xmlns:d="http://docbook.org/ns/docbook" bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div id="wrapper"><div class="header-wrapper"><header id="header"><ul class="header-list"><li class="header-item"><a href="http://janusgraph.org"><img src="images/janusgraph-logo.png" alt="JanusGraph" class="normal_logo"></a></li><li class="header-item-right"><a href="https://github.com/JanusGraph/janusgraph/releases">Download JanusGraph</a></li><li class="header-item-right dropdown"><a href="https://docs.janusgraph.org/latest/doc-versions.html">Other Doc Versions</a><div class="dropdown-content"><a href="https://docs.janusgraph.org/latest/index.html">Latest</a><a href="https://docs.janusgraph.org/0.3.1/index.html">Version 0.3.1</a><a href="https://docs.janusgraph.org/0.3.0/index.html">Version 0.3.0</a><a href="https://docs.janusgraph.org/0.2.2/index.html">Version 0.2.2</a><a href="https://docs.janusgraph.org/0.2.1/index.html">Version 0.2.1</a><a href="https://docs.janusgraph.org/0.2.0/index.html">Version 0.2.0</a><a href="https://docs.janusgraph.org/0.1.1/index.html">Version 0.1.1</a><a href="https://docs.janusgraph.org/0.1.0/index.html">Version 0.1.0</a></div></li><li class="header-item-right"><a href="index.html">Documentation (0.3.1)</a></li></ul></header></div><div id="main" class="clearfix width-100"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">JanusGraph Documentation</a></span> &gt; <span class="breadcrumb-link"><a href="index-backends.html">Index Backends</a></span> &gt; <span class="breadcrumb-node">Apache Solr</span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="solr"></a>Chapter&nbsp;28.&nbsp;Apache Solr</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="solr.html#_solr_configuration_overview">28.1. Solr Configuration Overview</a></span></dt><dt><span class="section"><a href="solr.html#_connecting_to_solrcloud">28.2. Connecting to SolrCloud</a></span></dt><dd><dl><dt><span class="section"><a href="solr.html#_configset_configuration">28.2.1. Configset Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="solr.html#_connecting_to_solr_standalone_http">28.3. Connecting to Solr Standalone (HTTP)</a></span></dt><dd><dl><dt><span class="section"><a href="solr.html#_core_configuration">28.3.1. Core Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="solr.html#_kerberos_configuration">28.4. Kerberos Configuration</a></span></dt><dt><span class="section"><a href="solr.html#_solr_schema_design">28.5. Solr Schema Design</a></span></dt><dd><dl><dt><span class="section"><a href="solr.html#_dynamic_field_definition">28.5.1. Dynamic Field Definition</a></span></dt><dt><span class="section"><a href="solr.html#_manual_field_definition">28.5.2. Manual Field Definition</a></span></dt><dt><span class="section"><a href="solr.html#_schemaless_mode">28.5.3. Schemaless Mode</a></span></dt></dl></dd><dt><span class="section"><a href="solr.html#_troubleshooting_2">28.6. Troubleshooting</a></span></dt><dd><dl><dt><span class="section"><a href="solr.html#_collection_does_not_exist">28.6.1. Collection Does Not Exist</a></span></dt><dt><span class="section"><a href="solr.html#_cannot_find_the_specified_configset">28.6.2. Cannot Find the Specified Configset</a></span></dt><dt><span class="section"><a href="solr.html#_http_error_404">28.6.3. HTTP Error 404</a></span></dt><dt><span class="section"><a href="solr.html#_invalid_core_or_collection_name">28.6.4. Invalid core or collection name</a></span></dt><dt><span class="section"><a href="solr.html#_connection_problems">28.6.5. Connection Problems</a></span></dt><dt><span class="section"><a href="solr.html#_jts_classnotfoundexception_with_geo_data">28.6.6. JTS ClassNotFoundException with Geo Data</a></span></dt></dl></dd><dt><span class="section"><a href="solr.html#_advanced_solr_configuration">28.7. Advanced Solr Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="solr.html#dse-search">28.7.1. DSE Search</a></span></dt></dl></dd></dl></div><div class="blockquote"><table border="0" class="blockquote" style="width: 100%; cellspacing: 0; cellpadding: 0;" summary="Block quote"><tr><td width="10%" valign="top">&nbsp;</td><td width="80%" valign="top"><p>Solr is the popular, blazing fast open source enterprise search platform from the Apache Lucene project. Solr is a standalone enterprise search server with a REST-like API. Solr is highly reliable, scalable and fault tolerant, providing distributed indexing, replication and load-balanced querying, automated failover and recovery, centralized configuration and more.</p></td><td width="10%" valign="top">&nbsp;</td></tr><tr><td width="10%" valign="top">&nbsp;</td><td colspan="2" align="right" valign="top">--<span class="attribution">
    
    <a class="link" href="http://lucene.apache.org/solr/" target="_top">Apache Solr Homepage</a>
    
    
  </span></td></tr></table></div><p>JanusGraph supports <a class="link" href="http://lucene.apache.org/solr/" target="_top">Apache Solr</a> as an index backend.  Here are some of the Solr features supported by JanusGraph:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>Full-Text</strong></span>: Supports all <code class="literal">Text</code> predicates to search for text properties that matches a given word, prefix or regular expression.</li><li class="listitem"><span class="strong"><strong>Geo</strong></span>: Supports all <code class="literal">Geo</code> predicates to search for geo properties that are intersecting, within, disjoint to or contained in a given query geometry. Supports points, lines and polygons for indexing. Supports circles, boxes and polygons for querying point properties and all shapes for querying non-point properties.</li><li class="listitem"><span class="strong"><strong>Numeric Range</strong></span>: Supports all numeric comparisons in <code class="literal">Compare</code>.</li><li class="listitem"><span class="strong"><strong>TTL</strong></span>: Supports automatically expiring indexed elements.</li><li class="listitem"><span class="strong"><strong>Temporal</strong></span>: Millisecond granularity temporal indexing.</li><li class="listitem"><span class="strong"><strong>Custom Analyzer</strong></span>: Choose to use a custom analyzer</li></ul></div><p>Please see <a class="xref" href="version-compat.html" title="Appendix&nbsp;B.&nbsp;Version Compatibility">Appendix&nbsp;B, <i>Version Compatibility</i></a> for details on what versions of Solr will work with JanusGraph.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_solr_configuration_overview"></a>28.1.&nbsp;Solr Configuration Overview</h2></div></div></div><p>JanusGraph supports Solr running in either a SolrCloud or Solr Standalone (HTTP) configuration for use with a <span class="strong"><strong>mixed index</strong></span> (see <a class="xref" href="indexes.html#index-mixed" title="11.1.2.&nbsp;Mixed Index">Section&nbsp;11.1.2, &#8220;Mixed Index&#8221;</a>). The desired connection mode is configured via the parameter <code class="literal">mode</code> which must be set to either <code class="literal">cloud</code> or <code class="literal">http</code>, the former being the default value.  For example, to explicitly specify that Solr is running in a SolrCloud configuration the following property is specified as a JanusGraph configuration property:</p><pre class="programlisting"><span class="hl-attribute">index.search.solr.mode</span>=cloud</pre><p>These are some key Solr terms:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>Core</strong></span>: A <span class="emphasis"><em>single index</em></span> on a single machine</li><li class="listitem"><span class="strong"><strong>Configuration</strong></span>: <span class="emphasis"><em>solrconfig.xml</em></span>, <span class="emphasis"><em>schema.xml</em></span>, and other files required to define a core.</li><li class="listitem"><span class="strong"><strong>Collection</strong></span>: A <span class="emphasis"><em>single logical index</em></span> that can span multiple cores on different machines.</li><li class="listitem"><span class="strong"><strong>Configset</strong></span>: A shared <span class="emphasis"><em>configuration</em></span> that can be reused by multiple cores.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_connecting_to_solrcloud"></a>28.2.&nbsp;Connecting to SolrCloud</h2></div></div></div><p>When connecting to a SolrCloud cluster by setting the <code class="literal">mode</code> equal to <code class="literal">cloud</code>, the Zookeeper URL (and optionally port) must be specified so that JanusGraph can discover and interact with the Solr cluster.</p><pre class="programlisting"><span class="hl-attribute">index.search.backend</span>=solr
<span class="hl-attribute">index.search.solr.mode</span>=cloud
<span class="hl-attribute">index.search.solr.zookeeper-url=localhost</span>:2181</pre><p>A number of additional configuration options pertaining to the creation of new collections (which is only supported in SolrCloud operation mode) can be configured to control sharding behavior among other things. Refer to the <a class="xref" href="config-ref.html" title="Chapter&nbsp;15.&nbsp;Configuration Reference">Chapter&nbsp;15, <i>Configuration Reference</i></a> for a complete listing of those options.</p><p>SolrCloud leverages Zookeeper to coordinate collection and configset information between the Solr servers. The use of Zookeeper with SolrCloud provides the opportunity to significantly reduce the amount of manual configuration required to use Solr as a back end index for JanusGraph.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_configset_configuration"></a>28.2.1.&nbsp;Configset Configuration</h3></div></div></div><p>A configset is required to create a collection. The configset is stored in Zookeeper to enable access to it across the Solr servers.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Each collection can provide its own configset when it is created, so that each collection may have a different configuration. With this approach, each collection must be created manually.</li><li class="listitem">A shared configset can be uploaded separately to Zookeeper if it will be reused by multiple collections. With this approach, JanusGraph can create collections automatically by using the shared configset. Another benefit is that reusing a configset significantly reduces the amount of data stored in Zookeeper.</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_using_an_individual_configset"></a>28.2.1.1.&nbsp;Using an Individual Configset</h4></div></div></div><p>In this example, a collection named <code class="literal">verticesByAge</code> is created manually using the default JanusGraph configuration for Solr that is found in the distribution. When the collection is created, the configuration is uploaded into Zookeeper, using the same collection name <code class="literal">verticesByAge</code> for the configset name. Refer to the <a class="link" href="https://lucene.apache.org/solr/guide/6_6/solr-control-script-reference.html#SolrControlScriptReference-CollectionsandCores" target="_top">Solr Reference Guide</a> for available parameters.</p><pre class="programlisting"><em class="hl-comment"># create the collection</em>
$SOLR_HOME/bin/solr create -c verticesByAge -d $JANUSGRAPH_HOME/conf/solr</pre><p>Define a mixed index using <code class="literal">JanusGraphManagement</code> and the same collection name.</p><pre class="programlisting">mgmt<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>graph.openManagement<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>age<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>mgmt.makePropertyKey<span class="hl-gremlin-func">(</span><span class="hl-string">"age"</span><span class="hl-gremlin-func">)</span>.dataType<span class="hl-gremlin-func">(</span>Integer.class<span class="hl-gremlin-func">)</span>.make<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.buildIndex<span class="hl-gremlin-func">(</span><span class="hl-string">"verticesByAge"</span>,<span class="hl-gremlin-func"> </span>Vertex.class<span class="hl-gremlin-func">)</span>.addKey<span class="hl-gremlin-func">(</span>age<span class="hl-gremlin-func">)</span>.buildMixedIndex<span class="hl-gremlin-func">(</span><span class="hl-string">"search"</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.commit<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span></pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_using_a_shared_configset"></a>28.2.1.2.&nbsp;Using a Shared Configset</h4></div></div></div><p>When using a shared configset, it is most convenient to upload the configuration first as a one time operation. In this example, a configset named <code class="literal">janusgraph-configset</code> is uploaded in to Zookeeper using the default JanusGraph configuration for Solr that is found in the distribution. Refer to the <a class="link" href="https://lucene.apache.org/solr/guide/6_6/solr-control-script-reference.html#SolrControlScriptReference-CollectionsandCores" target="_top">Solr Reference Guide</a> for available parameters.</p><pre class="programlisting"><em class="hl-comment"># upload the shared configset into Zookeeper</em>
<em class="hl-comment"># Solr 5</em>
$SOLR_HOME/server/scripts/cloud-scripts/zkcli.sh -cmd upconfig -z localhost:<span class="hl-number">2181</span> \
    -d $JANUSGRAPH_HOME/conf/solr -n janusgraph-configset
<em class="hl-comment"># Solr 6 and higher</em>
$SOLR_HOME/bin/solr zk upconfig -d $JANUSGRAPH_HOME/conf/solr -n janusgraph-configset \
    -z localhost:<span class="hl-number">2181</span></pre><p>When configuring the SolrCloud indexing backend for JanusGraph, make sure to provide the name of the shared configset using the <code class="literal">index.search.solr.configset</code> property.</p><pre class="programlisting"><span class="hl-attribute">index.search.backend</span>=solr
<span class="hl-attribute">index.search.solr.mode</span>=cloud
<span class="hl-attribute">index.search.solr.zookeeper-url=localhost</span>:2181
<span class="hl-attribute">index.search.solr.configset</span>=janusgraph-configset</pre><p>Define a mixed index using <code class="literal">JanusGraphManagement</code> and the collection name.</p><pre class="programlisting">mgmt<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>graph.openManagement<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>age<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>mgmt.makePropertyKey<span class="hl-gremlin-func">(</span><span class="hl-string">"age"</span><span class="hl-gremlin-func">)</span>.dataType<span class="hl-gremlin-func">(</span>Integer.class<span class="hl-gremlin-func">)</span>.make<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.buildIndex<span class="hl-gremlin-func">(</span><span class="hl-string">"verticesByAge"</span>,<span class="hl-gremlin-func"> </span>Vertex.class<span class="hl-gremlin-func">)</span>.addKey<span class="hl-gremlin-func">(</span>age<span class="hl-gremlin-func">)</span>.buildMixedIndex<span class="hl-gremlin-func">(</span><span class="hl-string">"search"</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.commit<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span></pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_connecting_to_solr_standalone_http"></a>28.3.&nbsp;Connecting to Solr Standalone (HTTP)</h2></div></div></div><p>When connecting to Solr Standalone via HTTP by setting the <code class="literal">mode</code> equal to <code class="literal">http</code>, a single or list of URLs for the Solr instances must be provided.</p><pre class="programlisting"><span class="hl-attribute">index.search.backend</span>=solr
<span class="hl-attribute">index.search.solr.mode</span>=http
<span class="hl-attribute">index.search.solr.http-urls=http://localhost</span>:8983/solr</pre><p>Additional configuration options for controlling the maximum number of connections, connection timeout and transmission compression are available for the HTTP mode. Refer to the <a class="xref" href="config-ref.html" title="Chapter&nbsp;15.&nbsp;Configuration Reference">Chapter&nbsp;15, <i>Configuration Reference</i></a> for a complete listing of those options.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_core_configuration"></a>28.3.1.&nbsp;Core Configuration</h3></div></div></div><p>Solr Standalone is used for a single instance, and it keeps configuration information on the file system. A core must be created manually for each mixed index.</p><p>To create a core, a <code class="literal">core_name</code> and a <code class="literal">configuration</code> directory is required. Refer to the <a class="link" href="https://lucene.apache.org/solr/guide/6_6/solr-control-script-reference.html#SolrControlScriptReference-CollectionsandCores" target="_top">Solr Reference Guide</a> for available parameters. In this example, a core named <code class="literal">verticesByAge</code> is created using the default JanusGraph configuration for Solr that is found in the distribution.</p><pre class="programlisting">$SOLR_HOME/bin/solr create -c verticesByAge -d $JANUSGRAPH_HOME/conf/solr</pre><p>Define a mixed index using <code class="literal">JanusGraphManagement</code> and the same core name.</p><pre class="programlisting">mgmt<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>graph.openManagement<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>age<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>mgmt.makePropertyKey<span class="hl-gremlin-func">(</span><span class="hl-string">"age"</span><span class="hl-gremlin-func">)</span>.dataType<span class="hl-gremlin-func">(</span>Integer.class<span class="hl-gremlin-func">)</span>.make<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.buildIndex<span class="hl-gremlin-func">(</span><span class="hl-string">"verticesByAge"</span>,<span class="hl-gremlin-func"> </span>Vertex.class<span class="hl-gremlin-func">)</span>.addKey<span class="hl-gremlin-func">(</span>age<span class="hl-gremlin-func">)</span>.buildMixedIndex<span class="hl-gremlin-func">(</span><span class="hl-string">"search"</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>mgmt.commit<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_kerberos_configuration"></a>28.4.&nbsp;Kerberos Configuration</h2></div></div></div><p>When connecting to a Solr environment that is protected by Kerberos we must specify that Kerberos is being used and reference a JAAS configuration file to properly configure the Solr Clients. This configuration is required when Kerberos is in use regardless of the mode in which Solr is operating (SolrCloud or Solr Standalone).</p><pre class="programlisting"><span class="hl-attribute">index.search.solr.kerberos-enabled</span>=true</pre><p>The JAAS configuration file is supplied by ensuring that you set the java system property <code class="literal">java.security.auth.login.config</code> with the absolute path to the file. This property should be set using JVM options. For example to run <code class="literal">gremlin.sh</code> you would need to set the <code class="literal">JAVA_OPTIONS</code> environment variable prior to running the script:</p><pre class="programlisting">---
<strong class="hl-keyword">export</strong> JAVA_OPTIONS=<span class="hl-string">"-Djava.security.auth.login.config=/absolute/path/jaas.conf"</span>
$JANUSGRAPH_HOME/bin/gremlin.sh
---</pre><p>For details on the content required in the JAAS configuration file refer to the <a class="link" href="https://lucene.apache.org/solr/guide/7_0/kerberos-authentication-plugin.html#define-a-jaas-configuration-file" target="_top">Solr Reference Guide</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_solr_schema_design"></a>28.5.&nbsp;Solr Schema Design</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_dynamic_field_definition"></a>28.5.1.&nbsp;Dynamic Field Definition</h3></div></div></div><p>By default, JanusGraph uses Solr&#8217;s <a class="link" href="https://cwiki.apache.org/confluence/display/solr/Dynamic+Fields" target="_top">Dynamic Fields</a> feature to define the field types for all indexed keys. This requires no extra configuration when adding property keys to a mixed index backed by Solr and provides better performance than schemaless mode.</p><p>JanusGraph assumes the following dynamic field tags are defined in the backing Solr collection&#8217;s schema.xml file. Please note that there
is additional xml definition of the following fields required in a solr schema.xml file in order to use them.  Reference the example schema.xml file provided in the ./conf/solr/schema.xml directory in a JanusGraph installation for more information.</p><pre class="programlisting">   <strong class="hl-tag" style="color: #000096">&lt;dynamicField</strong> <span class="hl-attribute">name</span>=<span class="hl-value" style="color: #993300">"*_i"</span>    <span class="hl-attribute">type</span>=<span class="hl-value" style="color: #993300">"int"</span>          <span class="hl-attribute">indexed</span>=<span class="hl-value" style="color: #993300">"true"</span>  <span class="hl-attribute">stored</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
   <strong class="hl-tag" style="color: #000096">&lt;dynamicField</strong> <span class="hl-attribute">name</span>=<span class="hl-value" style="color: #993300">"*_s"</span>    <span class="hl-attribute">type</span>=<span class="hl-value" style="color: #993300">"string"</span>       <span class="hl-attribute">indexed</span>=<span class="hl-value" style="color: #993300">"true"</span>  <span class="hl-attribute">stored</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096"> /&gt;</strong>
   <strong class="hl-tag" style="color: #000096">&lt;dynamicField</strong> <span class="hl-attribute">name</span>=<span class="hl-value" style="color: #993300">"*_l"</span>    <span class="hl-attribute">type</span>=<span class="hl-value" style="color: #993300">"long"</span>         <span class="hl-attribute">indexed</span>=<span class="hl-value" style="color: #993300">"true"</span>  <span class="hl-attribute">stored</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
   <strong class="hl-tag" style="color: #000096">&lt;dynamicField</strong> <span class="hl-attribute">name</span>=<span class="hl-value" style="color: #993300">"*_t"</span>    <span class="hl-attribute">type</span>=<span class="hl-value" style="color: #993300">"text_general"</span> <span class="hl-attribute">indexed</span>=<span class="hl-value" style="color: #993300">"true"</span>  <span class="hl-attribute">stored</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
   <strong class="hl-tag" style="color: #000096">&lt;dynamicField</strong> <span class="hl-attribute">name</span>=<span class="hl-value" style="color: #993300">"*_b"</span>    <span class="hl-attribute">type</span>=<span class="hl-value" style="color: #993300">"boolean"</span>      <span class="hl-attribute">indexed</span>=<span class="hl-value" style="color: #993300">"true"</span> <span class="hl-attribute">stored</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
   <strong class="hl-tag" style="color: #000096">&lt;dynamicField</strong> <span class="hl-attribute">name</span>=<span class="hl-value" style="color: #993300">"*_f"</span>    <span class="hl-attribute">type</span>=<span class="hl-value" style="color: #993300">"float"</span>        <span class="hl-attribute">indexed</span>=<span class="hl-value" style="color: #993300">"true"</span>  <span class="hl-attribute">stored</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
   <strong class="hl-tag" style="color: #000096">&lt;dynamicField</strong> <span class="hl-attribute">name</span>=<span class="hl-value" style="color: #993300">"*_d"</span>    <span class="hl-attribute">type</span>=<span class="hl-value" style="color: #993300">"double"</span>       <span class="hl-attribute">indexed</span>=<span class="hl-value" style="color: #993300">"true"</span>  <span class="hl-attribute">stored</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
   <strong class="hl-tag" style="color: #000096">&lt;dynamicField</strong> <span class="hl-attribute">name</span>=<span class="hl-value" style="color: #993300">"*_g"</span>    <span class="hl-attribute">type</span>=<span class="hl-value" style="color: #993300">"geo"</span>          <span class="hl-attribute">indexed</span>=<span class="hl-value" style="color: #993300">"true"</span>  <span class="hl-attribute">stored</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
   <strong class="hl-tag" style="color: #000096">&lt;dynamicField</strong> <span class="hl-attribute">name</span>=<span class="hl-value" style="color: #993300">"*_dt"</span>   <span class="hl-attribute">type</span>=<span class="hl-value" style="color: #993300">"date"</span>         <span class="hl-attribute">indexed</span>=<span class="hl-value" style="color: #993300">"true"</span>  <span class="hl-attribute">stored</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
   <strong class="hl-tag" style="color: #000096">&lt;dynamicField</strong> <span class="hl-attribute">name</span>=<span class="hl-value" style="color: #993300">"*_uuid"</span> <span class="hl-attribute">type</span>=<span class="hl-value" style="color: #993300">"uuid"</span>         <span class="hl-attribute">indexed</span>=<span class="hl-value" style="color: #993300">"true"</span>  <span class="hl-attribute">stored</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
</pre><p>In JanusGraph&#8217;s default configuration, property key names do not have to end with the type-appropriate suffix to take advantage of Solr&#8217;s dynamic field feature.  JanusGraph generates the Solr field name from the property key name by encoding the property key definition&#8217;s numeric identifier and the type-appropriate suffix.  This means that JanusGraph uses synthetic field names with type-appropriate suffixes behind the scenes, regardless of the property key names defined and used by application code using JanusGraph.  This field name mapping can be overridden through non-default configuration.  That&#8217;s described in the next section.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_manual_field_definition"></a>28.5.2.&nbsp;Manual Field Definition</h3></div></div></div><p>If the user would rather manually define the field types for each of the indexed fields in a collection, the configuration option <code class="literal">dyn-fields</code> needs to be disabled.  It is important that the field for each indexed property key is defined in the backing Solr schema before the property key is added to the index.</p><p>In this scenario, it is advisable to enable explicit property key name to field mapping in order to fix the field names for their explicit definition. This can be achieved in one of two ways:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Configuring the name of the field by providing a <code class="literal">mapped-name</code> parameter when adding the property key to the index. See <a class="xref" href="field-mapping.html#index-local-field-mapping" title="25.1.&nbsp;Individual Field Mapping">Section&nbsp;25.1, &#8220;Individual Field Mapping&#8221;</a> for more information.</li><li class="listitem">By enabling the <code class="literal">map-name</code> configuration option for the Solr index which will use the property key name as the field name in Solr. See <a class="xref" href="field-mapping.html#index-global-field-mapping" title="25.2.&nbsp;Global Field Mapping">Section&nbsp;25.2, &#8220;Global Field Mapping&#8221;</a> for more information.</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_schemaless_mode"></a>28.5.3.&nbsp;Schemaless Mode</h3></div></div></div><p>JanusGraph can also interact with a SolrCloud cluster that is configured for <a class="link" href="https://cwiki.apache.org/confluence/display/solr/Schemaless+Mode" target="_top">schemaless mode</a>. In this scenario, the configuration option <code class="literal">dyn-fields</code> should be disabled since Solr will infer the field type from the values and not the field name.</p><p>Note, however, that schemaless mode is recommended only for prototyping and initial application development and NOT recommended for production use.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_troubleshooting_2"></a>28.6.&nbsp;Troubleshooting</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_collection_does_not_exist"></a>28.6.1.&nbsp;Collection Does Not Exist</h3></div></div></div><p>The collection (and all of the required configuration files) must be initialized before a defined index can use the collection. See <a class="link" href="solr.html#_connecting_to_solrcloud" title="28.2.&nbsp;Connecting to SolrCloud">Connecting to SolrCloud</a> for more information.</p><p>When using SolrCloud, the Zookeeper zkCli.sh command line tool can be used to inspect the configurations loaded into Zookeeper.  Also verify that
the default JanusGraph configuration files are copied to the correct location under solr and that the directory where the files are copied is correct.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_cannot_find_the_specified_configset"></a>28.6.2.&nbsp;Cannot Find the Specified Configset</h3></div></div></div><p>When using SolrCloud, a configset is required to create a mixed index for JanusGraph. See <a class="link" href="solr.html#_configset_configuration" title="28.2.1.&nbsp;Configset Configuration">Configset Configuration</a> for more information.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">If using an individual configset, the collection must be created manually first.</li><li class="listitem">If using a shared configset, the configset must be uploaded into Zookeeper first.</li></ul></div><p>You can verify that the configset and its configuration files are in Zookeeper under <code class="literal">/configs</code>. Refer to the <a class="link" href="https://lucene.apache.org/solr/guide/6_6/solr-control-script-reference.html#SolrControlScriptReference-ZooKeeperOperations" target="_top">Solr Reference Guide</a> for other Zookeeper operations.</p><pre class="programlisting"><em class="hl-comment"># verify the configset in Zookeeper</em>
<em class="hl-comment"># Solr 5</em>
$SOLR_HOME/server/scripts/cloud-scripts/zkcli.sh -cmd list -z localhost:<span class="hl-number">2181</span>
<em class="hl-comment"># Solr 6 and higher</em>
$SOLR_HOME/bin/solr zk ls -r /configs/configset-name -z localhost:<span class="hl-number">2181</span></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_http_error_404"></a>28.6.3.&nbsp;HTTP Error 404</h3></div></div></div><p>This error may be encountered when using Solr Standalone (HTTP) mode. An example of the error:</p><pre class="programlisting">20:01:22 ERROR org.janusgraph.diskstorage.solr.SolrIndex  - Unable to save documents
to Solr as one of the shape objects stored were not compatible with Solr.
org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server
at http://localhost:8983/solr: Expected mime type application/octet-stream but got text/html.
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html;charset=utf-8"/&gt;
&lt;title&gt;Error 404 Not Found&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;&lt;h2&gt;HTTP ERROR 404&lt;/h2&gt;
&lt;p&gt;Problem accessing /solr/verticesByAge/update. Reason:
&lt;pre&gt;    Not Found&lt;/pre&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</pre><p>Make sure to create the core manually before attempting to store data into the index. See <a class="link" href="solr.html#_core_configuration" title="28.3.1.&nbsp;Core Configuration">Core Configuration</a> for more information.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_invalid_core_or_collection_name"></a>28.6.4.&nbsp;Invalid core or collection name</h3></div></div></div><p>The core or collection name is an identifier. It must consist entirely of periods, underscores, hyphens, and/or alphanumerics, and also it may not start with a hyphen.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_connection_problems"></a>28.6.5.&nbsp;Connection Problems</h3></div></div></div><p>Irrespective of the operation mode, a Solr instance or a cluster of Solr instances must be running and accessible from the JanusGraph instance(s) in order for JanusGraph to use Solr as an indexing backend. Check that the Solr cluster is running correctly and that it is visible and accessible over the network (or locally) from the JanusGraph instances.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_jts_classnotfoundexception_with_geo_data"></a>28.6.6.&nbsp;JTS ClassNotFoundException with Geo Data</h3></div></div></div><p>Solr relies on Spatial4j for geo processing.  Spatial4j declares an optional dependency on JTS ("JTS Topology Suite").  JTS is required for some geo field definition and query functionality.  If the JTS jar is not on the Solr daemon&#8217;s classpath and a field in schema.xml uses a geo type, then Solr may throw a ClassNotFoundException on one of the missing JTS classes.  The exception can appear when starting Solr using a schema.xml file designed to work with JanusGraph, but can also appear when invoking <code class="literal">CREATE</code> in the <a class="link" href="https://wiki.apache.org/solr/CoreAdmin" target="_top">Solr CoreAdmin API</a>.  The exception appears in slightly different formats on the client and server sides, although the root cause is identical.</p><p>Here&#8217;s a representative example from a Solr server log:</p><pre class="programlisting">ERROR [http-8983-exec-5] 2014-10-07 02:54:06, 665 SolrCoreResourceManager.java (line 344) com/vividsolutions/jts/geom/Geometry
java.lang.NoClassDefFoundError: com/vividsolutions/jts/geom/Geometry
        at com.spatial4j.core.context.jts.JtsSpatialContextFactory.newSpatialContext(JtsSpatialContextFactory.java:30)
        at com.spatial4j.core.context.SpatialContextFactory.makeSpatialContext(SpatialContextFactory.java:83)
        at org.apache.solr.schema.AbstractSpatialFieldType.init(AbstractSpatialFieldType.java:95)
        at org.apache.solr.schema.AbstractSpatialPrefixTreeFieldType.init(AbstractSpatialPrefixTreeFieldType.java:43)
        at org.apache.solr.schema.SpatialRecursivePrefixTreeFieldType.init(SpatialRecursivePrefixTreeFieldType.java:37)
        at org.apache.solr.schema.FieldType.setArgs(FieldType.java:164)
        at org.apache.solr.schema.FieldTypePluginLoader.init(FieldTypePluginLoader.java:141)
        at org.apache.solr.schema.FieldTypePluginLoader.init(FieldTypePluginLoader.java:43)
        at org.apache.solr.util.plugin.AbstractPluginLoader.load(AbstractPluginLoader.java:190)
        at org.apache.solr.schema.IndexSchema.readSchema(IndexSchema.java:470)
        at com.datastax.bdp.search.solr.CassandraIndexSchema.readSchema(CassandraIndexSchema.java:72)
        at org.apache.solr.schema.IndexSchema.&lt;init&gt;(IndexSchema.java:168)
        at com.datastax.bdp.search.solr.CassandraIndexSchema.&lt;init&gt;(CassandraIndexSchema.java:54)
        at com.datastax.bdp.search.solr.core.CassandraCoreContainer.create(CassandraCoreContainer.java:210)
        at com.datastax.bdp.search.solr.core.SolrCoreResourceManager.createCore(SolrCoreResourceManager.java:256)
        at com.datastax.bdp.search.solr.handler.admin.CassandraCoreAdminHandler.handleCreateAction(CassandraCoreAdminHandler.java:117)
        ...</pre><p>Here&#8217;s what normally appears in the output of the client that issued the associated <code class="literal">CREATE</code> command to the CoreAdmin API:</p><pre class="programlisting">org.apache.solr.common.SolrException: com/vividsolutions/jts/geom/Geometry
        at com.datastax.bdp.search.solr.core.SolrCoreResourceManager.createCore(SolrCoreResourceManager.java:345)
        at com.datastax.bdp.search.solr.handler.admin.CassandraCoreAdminHandler.handleCreateAction(CassandraCoreAdminHandler.java:117)
        at org.apache.solr.handler.admin.CoreAdminHandler.handleRequestBody(CoreAdminHandler.java:152)
        ...</pre><p>This is resolved by adding the JTS jar to the classpath of JanusGraph and/or the Solr server.  JTS is not included in JanusGraph distributions by default due to its LGPL license. Users must download the <a class="link" href="http://search.maven.org/remotecontent?filepath=com/vividsolutions/jts/1.13/jts-1.13.jar" target="_top">JTS jar file</a> separately and copy it into the JanusGraph and/or Solr server lib directory.  If using Solr&#8217;s built in web server, the JTS jar may be copied to the example/solr-webapp/webapp/WEB-INF/lib directory to include it in the classpath.  Solr can be restarted, and the exception should be gone. Solr must be started once with the correct schema.xml file in place first, for the example/solr-webapp/webapp/WEB-INF/lib directory to exist.</p><p>To determine the ideal JTS version for Solr server, first check the version of Spatial4j in use by the Solr cluster, then determine the version of JTS against which that Spatial4j version was compiled.  Spatial4j declares its target JTS version in the <a class="link" href="http://search.maven.org/#search|gav|1|g%3A%22com.spatial4j%22%20AND%20a%3A%22spatial4j%22" target="_top">pom for the <code class="literal">com.spatial4j:spatial4j</code> artifact</a>.
Copy the JTS jar to the server/solr-webapp/webapp/WEB-INF/lib directory in your solr installation.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_advanced_solr_configuration"></a>28.7.&nbsp;Advanced Solr Configuration</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="dse-search"></a>28.7.1.&nbsp;DSE Search</h3></div></div></div><p>This section covers installation and configuration of JanusGraph with DataStax Enterprise (DSE) Search.  There are multiple ways to install DSE, but this section focuses on DSE&#8217;s binary tarball install option on Linux.  Most of the steps in this section can be generalized to the other install options for DSE.</p><p>Install DataStax Enterprise as directed by the page <a class="link" href="http://www.datastax.com/documentation/datastax_enterprise/4.5/datastax_enterprise/install/installTARdse.html" target="_top">Installing DataStax Enterprise using the binary tarball</a>.</p><p>Export <code class="literal">DSE_HOME</code> and append to <code class="literal">PATH</code> in your shell environment.  Here&#8217;s an example using Bash syntax:</p><pre class="programlisting"><strong class="hl-keyword">export</strong> DSE_HOME=/path/to/dse-version.number
<strong class="hl-keyword">export</strong> PATH=<span class="hl-string">"$DSE_HOME"</span>/bin:<span class="hl-string">"$PATH"</span></pre><p>Install JTS for Solr.  The appropriate version varies with the Spatial4j version.  As of DSE 4.5.2, the appropriate version is 1.13.</p><pre class="programlisting"><strong class="hl-keyword">cd</strong> $DSE_HOME/resources/solr/lib
curl -O <span class="hl-string">'http://central.maven.org/maven2/com/vividsolutions/jts/1.13/jts-1.13.jar'</span></pre><p>Start DSE Cassandra and Solr in a single background daemon:</p><pre class="programlisting"><em class="hl-comment"># The "dse-data" path below was chosen to match the</em>
<em class="hl-comment"># "Installing DataStax Enterprise using the binary tarball"</em>
<em class="hl-comment"># documentation page from DataStax.  The exact path is not</em>
<em class="hl-comment"># significant.</em>
dse cassandra -s -Ddse.solr.data.dir=<span class="hl-string">"$DSE_HOME"</span>/dse-data/solr</pre><p>The previous command will write some startup information to the console and to the logfile path <code class="literal">log4j.appender.R.File</code> configured in <code class="literal">$DSE_HOME/resources/cassandra/conf/log4j-server.properties</code>.</p><p>Once DSE with Cassandra and Solr has started normally, check the cluster health with <code class="literal">nodetool status</code>.  A single-instance ring should show one node with flags *U*p and *N*ormal:</p><pre class="programlisting">nodetool status
Note: Ownership information does not include topology; <strong class="hl-keyword">for</strong> complete information, specify a keyspace
= Datacenter: Solr
Status=Up/Down
|/ State=Normal/Leaving/Joining/Moving
--  Address    Load       Owns   Host ID                               Token                                    Rack
UN  <span class="hl-number">127.0</span>.<span class="hl-number">0.1</span>  <span class="hl-number">99.89</span> KB   <span class="hl-number">100.0</span>%  <span class="hl-number">5484</span>ef7b-ebce-<span class="hl-number">4560</span>-<span class="hl-number">80</span>f0-cbdcd9e9f496  -<span class="hl-number">7317038863489909889</span>                     rack1</pre><p>Next, switch to Gremlin Console and open a JanusGraph database against the DSE instance.  This will create JanusGraph&#8217;s keyspace and column families.</p><pre class="programlisting">cd<span class="hl-gremlin-func"> </span>$JANUSGRAPH_HOM<span class="hl-gremlin-func">E
</span>bin/gremlin.sh<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span>\,,,/<span class="hl-gremlin-func">
</span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func"> </span><span class="hl-gremlin-func">(</span>o<span class="hl-gremlin-func"> </span>o<span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>-----oOOo-<span class="hl-gremlin-func">(</span><span class="hl-number">3</span><span class="hl-gremlin-func">)</span>-oOOo-----<span class="hl-gremlin-func">
</span><span class="hl-repl-prompt">gremlin&gt;</span><span class="hl-gremlin-func"> </span>graph<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>JanusGraphFactory.open<span class="hl-gremlin-func">(</span><span class="hl-string">'conf/janusgraph-cql-solr.properties'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span><span class="hl-repl-result">==&gt;</span>janusgraph[cql:[<span class="hl-number">127.0</span>.<span class="hl-number">0.1</span>]]<span class="hl-gremlin-func">
</span><span class="hl-repl-prompt">gremlin&gt;</span><span class="hl-gremlin-func"> </span>g<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>graph.traversal<span class="hl-gremlin-func">(</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span><span class="hl-repl-result">==&gt;</span>graphtraversalsource[janusgraph[cql:[<span class="hl-number">127.0</span>.<span class="hl-number">0.1</span>]],<span class="hl-gremlin-func"> </span>standard]<span class="hl-gremlin-func">
</span><span class="hl-repl-prompt">gremlin&gt;</span></pre><p>Keep this Gremlin Console open.  We&#8217;ll take a break now to install
a Solr core.  Then we&#8217;ll come back to this console to load some sample
data.</p><p>Next, upload configuration files for JanusGraph&#8217;s Solr collection, then
create the core in DSE:</p><pre class="programlisting"><em class="hl-comment"># Change to the directory where JanusGraph was extracted.  Later commands</em>
<em class="hl-comment"># use relative paths to the Solr config files shipped with the JanusGraph</em>
<em class="hl-comment"># distribution.</em>
<strong class="hl-keyword">cd</strong> $JANUSGRAPH_HOME

<em class="hl-comment"># The name must be URL safe and should contain one dot/full-stop</em>
<em class="hl-comment"># character. The part of the name after the dot must not conflict with</em>
<em class="hl-comment"># any of JanusGraph's internal CF names.  Starting the part after the dot</em>
<em class="hl-comment"># "solr" will avoid a conflict with JanusGraph's internal CF names.</em>
CORE_NAME=janusgraph.solr1
<em class="hl-comment"># Where to upload collection configuration and send CoreAdmin requests.</em>
SOLR_HOST=localhost:<span class="hl-number">8983</span>

<em class="hl-comment"># The value of index.[X].solr.http-urls in JanusGraph's config file</em>
<em class="hl-comment"># should match $SOLR_HOST and $CORE_NAME.  For example, given the</em>
<em class="hl-comment"># $CORE_NAME and $SOLR_HOST values above, JanusGraph's config file would</em>
<em class="hl-comment"># contain (assuming "search" is the desired index alias):</em>
<em class="hl-comment">#</em>
<em class="hl-comment"># index.search.solr.http-urls=http://localhost:8983/solr/janusgraph.solr1</em>
<em class="hl-comment">#</em>
<em class="hl-comment"># The stock JanusGraph config file conf/janusgraph-cql-solr.properties</em>
<em class="hl-comment"># ships with this http-urls value.</em>

<em class="hl-comment"># Upload Solr config files to DSE Search daemon</em>
<strong class="hl-keyword">for</strong> xml in conf/solr/{solrconfig, schema, elevate}.xml ; <strong class="hl-keyword">do</strong>
    curl -v http://<span class="hl-string">"$SOLR_HOST"</span>/solr/resource/<span class="hl-string">"$CORE_NAME/$xml"</span> \
      --data-binary @<span class="hl-string">"$xml"</span> -H <span class="hl-string">'Content-type:text/xml; charset=utf-8'</span>
<strong class="hl-keyword">done</strong>
<strong class="hl-keyword">for</strong> txt in conf/solr/{protwords, stopwords, synonyms}.txt ; <strong class="hl-keyword">do</strong>
    curl -v http://<span class="hl-string">"$SOLR_HOST"</span>/solr/resource/<span class="hl-string">"$CORE_NAME/$txt"</span> \
      --data-binary @<span class="hl-string">"$txt"</span> -H <span class="hl-string">'Content-type:text/plain; charset=utf-8'</span>
<strong class="hl-keyword">done</strong>
sleep <span class="hl-number">5</span>

<em class="hl-comment"># Create core using the Solr config files just uploaded above</em>
curl <span class="hl-string">"http://"</span>$SOLR_HOST<span class="hl-string">"/solr/admin/cores?action=CREATE&amp;name=$CORE_NAME"</span>
sleep <span class="hl-number">5</span>

<em class="hl-comment"># Retrieve and print the status of the core we just created</em>
curl <span class="hl-string">"http://localhost:8983/solr/admin/cores?action=STATUS&amp;core=$CORE_NAME"</span></pre><p>Now the JanusGraph database and backing Solr core are ready for use.  We
can test it out with the <a class="link" href="getting-started.html" title="Chapter&nbsp;3.&nbsp;Getting Started">Graph of the Gods</a>
dataset.  Picking up the Gremlin Console session started above:</p><pre class="programlisting"><em class="hl-comment">// Assuming graph = JanusGraphFactory.open('conf/janusgraph-cql-solr.properties')...</em><span class="hl-gremlin-func">
</span><span class="hl-repl-prompt">gremlin&gt;</span><span class="hl-gremlin-func"> </span>GraphOfTheGodsFactory.load<span class="hl-gremlin-func">(</span>graph<span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span><span class="hl-repl-result">==&gt;</span>null</pre><p>Now we can run any of the queries described in <a class="xref" href="getting-started.html" title="Chapter&nbsp;3.&nbsp;Getting Started">Chapter&nbsp;3, <i>Getting Started</i></a>.
Queries involving text and geo predicates will be served by Solr.  For
more verbose reporting from JanusGraph and the Solr client, run <code class="literal">gremlin.sh
-l DEBUG</code> and issue some index-backed queries.</p></div></div></div></div><div class="clearer"></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="elasticsearch.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index-backends.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="lucene.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;27.&nbsp;Elasticsearch&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;29.&nbsp;Apache Lucene</td></tr></table></div><div class="footer-wrapper"><footer id="footer"><div class="copyright">
              Copyright &copy; 2017 JanusGraph Authors. All rights reserved.<br>
              The Linux Foundation has registered trademarks and uses trademarks. For a list of<br>
              trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage">Trademark Usage</a> page.<br>
              Cassandra, Groovy, HBase, Hadoop, Lucene, Solr, and TinkerPop are trademarks of the Apache Software Foundation.<br>
              Berkeley DB and Berkeley DB Java Edition are trademarks of Oracle.<br>
              Documentation generated with <a href="http://www.methods.co.nz/asciidoc/">AsciiDoc</a>, <a href="http://asciidoctor.org/">AsciiDoctor</a>, <a href="http://docbook.sourceforge.net/">DocBook</a>, and <a href="http://saxon.sourceforge.net/">Saxon</a>.
        	  </div></footer></div></div></body></html>