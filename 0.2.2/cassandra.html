<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;17.&nbsp;Apache Cassandra</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="JanusGraph Documentation"><link rel="up" href="storage-backends.html" title="Part&nbsp;III.&nbsp;Storage Backends"><link rel="prev" href="storage-backends.html" title="Part&nbsp;III.&nbsp;Storage Backends"><link rel="next" href="hbase.html" title="Chapter&nbsp;18.&nbsp;Apache HBase"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-1.11.0.js"></script><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-migrate-1.2.1.min.js"></script><link xmlns:d="http://docbook.org/ns/docbook" rel="stylesheet" id="inline-blob-janusgraph-docs-specific" href="css/docs.css" type="text/css" media="all"><link xmlns:d="http://docbook.org/ns/docbook" rel="apple-touch-icon" type="image/png" href="images/janusgraph-logomark.png"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript">
      WebFontConfig = {
        google: {
          families: [
            "Lato:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Open+Sans:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Antic+Slab:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese"
          ]
        }
      };
      (function() {
      var wf = document.createElement('script');
      wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
        '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
	wf.type = 'text/javascript';
	wf.async = 'true';
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(wf, s);
	})();
    </script></head><body xmlns:d="http://docbook.org/ns/docbook" bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div id="wrapper"><div class="header-wrapper"><header id="header"><ul class="header-list"><li class="header-item"><a href="http://janusgraph.org"><img src="images/janusgraph-logo.png" alt="JanusGraph" class="normal_logo"></a></li><li class="header-item-right"><a href="https://github.com/JanusGraph/janusgraph/releases">Download JanusGraph</a></li><li class="header-item-right dropdown"><a href="https://docs.janusgraph.org/latest/doc-versions.html">Other Doc Versions</a><div class="dropdown-content"><a href="https://docs.janusgraph.org/latest/index.html">Latest</a><a href="https://docs.janusgraph.org/0.3.0/index.html">Version 0.3.0</a><a href="https://docs.janusgraph.org/0.2.2/index.html">Version 0.2.2</a><a href="https://docs.janusgraph.org/0.2.1/index.html">Version 0.2.1</a><a href="https://docs.janusgraph.org/0.2.0/index.html">Version 0.2.0</a><a href="https://docs.janusgraph.org/0.1.1/index.html">Version 0.1.1</a><a href="https://docs.janusgraph.org/0.1.0/index.html">Version 0.1.0</a></div></li><li class="header-item-right"><a href="index.html">Documentation (0.2.2)</a></li></ul></header></div><div id="main" class="clearfix width-100"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">JanusGraph Documentation</a></span> &gt; <span class="breadcrumb-link"><a href="storage-backends.html">Storage Backends</a></span> &gt; <span class="breadcrumb-node">Apache Cassandra</span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="cassandra"></a>Chapter&nbsp;17.&nbsp;Apache Cassandra</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="cassandra.html#cassandra-storage-backend">17.1. Cassandra Storage Backend</a></span></dt><dt><span class="section"><a href="cassandra.html#cassandra-local-server-mode">17.2. Local Server Mode</a></span></dt><dt><span class="section"><a href="cassandra.html#_local_container_mode">17.3. Local Container Mode</a></span></dt><dt><span class="section"><a href="cassandra.html#_remote_server_mode">17.4. Remote Server Mode</a></span></dt><dt><span class="section"><a href="cassandra.html#_remote_server_mode_with_gremlin_server">17.5. Remote Server Mode with Gremlin Server</a></span></dt><dt><span class="section"><a href="cassandra.html#_janusgraph_embedded_mode">17.6. JanusGraph Embedded Mode</a></span></dt><dt><span class="section"><a href="cassandra.html#_cassandra_specific_configuration">17.7. Cassandra Specific Configuration</a></span></dt><dt><span class="section"><a href="cassandra.html#_global_graph_operations">17.8. Global Graph Operations</a></span></dt><dt><span class="section"><a href="cassandra.html#_deploying_on_amazon_ec2">17.9. Deploying on Amazon EC2</a></span></dt><dd><dl><dt><span class="section"><a href="cassandra.html#_setup_cassandra_cluster">17.9.1. Setup Cassandra Cluster</a></span></dt><dt><span class="section"><a href="cassandra.html#_setting_up_security_group">17.9.2. Setting up Security Group</a></span></dt><dt><span class="section"><a href="cassandra.html#_launch_datastax_cassandra_ami">17.9.3. Launch DataStax Cassandra AMI</a></span></dt><dt><span class="section"><a href="cassandra.html#_verify_successful_instance_launch">17.9.4. Verify Successful Instance Launch</a></span></dt><dt><span class="section"><a href="cassandra.html#_launch_janusgraph_instances">17.9.5. Launch JanusGraph Instances</a></span></dt><dt><span class="section"><a href="cassandra.html#_example_janusgraph_instance_on_amazon_linux_ami">17.9.6. Example JanusGraph Instance on Amazon Linux AMI</a></span></dt><dt><span class="section"><a href="cassandra.html#_connect_to_cassandra_cluster_in_ec2_from_outside_ec2">17.9.7. Connect to Cassandra cluster in EC2 from outside EC2</a></span></dt></dl></dd></dl></div><div class="blockquote"><table border="0" class="blockquote" style="width: 100%; cellspacing: 0; cellpadding: 0;" summary="Block quote"><tr><td width="10%" valign="top">&nbsp;</td><td width="80%" valign="top"><p>The Apache Cassandra database is the right choice when you need
scalability and high availability without compromising
performance. Linear scalability and proven fault-tolerance on
commodity hardware or cloud infrastructure make it the perfect
platform for mission-critical data. Cassandra&#8217;s support for
replicating across multiple datacenters is best-in-class, providing
lower latency for your users and the peace of mind of knowing that you
can survive regional outages. The largest known Cassandra cluster has
over 300 TB of data in over 400 machines.</p></td><td width="10%" valign="top">&nbsp;</td></tr><tr><td width="10%" valign="top">&nbsp;</td><td colspan="2" align="right" valign="top">--<span class="attribution">
    
    <a class="link" href="http://cassandra.apache.org/" target="_top">Apache Cassandra Homepage</a>
    
    
  </span></td></tr></table></div><p>The following sections outline the various ways in which JanusGraph can be used in concert with Apache Cassandra.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cassandra-storage-backend"></a>17.1.&nbsp;Cassandra Storage Backend</h2></div></div></div><p>JanusGraph provides the following backends for use with Cassandra:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">cql</code> - CQL based driver. This is the recommended driver.</li><li class="listitem"><code class="literal">cassandrathrift</code> - JanusGraph&#8217;s Thrift connection pool driver</li><li class="listitem"><code class="literal">cassandra</code> - <a class="link" href="https://github.com/Netflix/astyanax" target="_top">Astyanax</a> driver. The Astyanax project is <a class="link" href="https://medium.com/netflix-techblog/astyanax-retiring-an-old-friend-6cca1de9ac4" target="_top">retired</a>.</li><li class="listitem"><code class="literal">embeddedcassandra</code> - Embedded driver for running Cassandra and JanusGraph within the same JVM</li></ul></div><p>Cassandra has two protocols for clients to use: CQL and Thrift. Thrift was the original interface, however it was deprecated starting with Cassandra 2.1. The core of JanusGraph was originally written before the deprecation of Thrift, and it has several classes that support Thrift. With Cassandra 4.0, Thrift support will be removed in Cassandra. JanusGraph users are recommended to use the <code class="literal">cql</code> storage backend.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you plan to use a Thrift-based driver and you are using Cassandra 2.2 or higher, you need to explicitly enable Thrift so that JanusGraph can connect to the cluster.
Do so by running <code class="literal">./bin/nodetool enablethrift</code> on every Cassandra node.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If security is enabled on Cassandra, the user must have <code class="literal">CREATE permission on &lt;all keyspaces&gt;</code>,
otherwise the keyspace must be created ahead of time by an administrator including the required tables or the user must have <code class="literal">CREATE permission on &lt;the configured keyspace&gt;</code>.
The create table file containing the required tables is located in <code class="literal">conf/cassandra/cassandraTables.cql</code>. Please define your keyspace before executing it.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cassandra-local-server-mode"></a>17.2.&nbsp;Local Server Mode</h2></div></div></div><p><span class="inlinemediaobject"><img src="images/modes-local.png" alt="modes-local"></span></p><p>Cassandra can be run as a standalone database on the same local host as JanusGraph and the end-user application. In this model, JanusGraph and Cassandra communicate with one another via a <code class="literal">localhost</code> socket. Running JanusGraph over Cassandra requires the following setup steps:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><a class="link" href="http://cassandra.apache.org/download/" target="_top">Download Cassandra</a>, unpack it, and set filesystem paths in <code class="literal">conf/cassandra.yaml</code> and <code class="literal">conf/log4j-server.properties</code></li><li class="listitem">Connecting Gremlin Server to Cassandra using the default configuration files provided in the pre-packaged distribution requires that Cassandra Thrift is enabled. To enable Cassandra Thrift open <code class="literal">conf/cassandra.yaml</code> and update <code class="literal">start_rpc: false</code> to <code class="literal">start_rpc: true</code>. If Cassandra is already running Thrift can be started manually with <code class="literal">bin/nodetool enablethrift</code>. the Thrift status can be verified with <code class="literal">bin/nodetool</code> statusthrift.</li><li class="listitem"><p class="simpara">Start Cassandra by invoking <code class="literal">bin/cassandra -f</code> on the command line in the directory where Cassandra was unpacked.  Read output to check that Cassandra started successfully.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Now, you can create a Cassandra JanusGraph as follows</span></dt><dd></dd></dl></div><pre class="programlisting">JanusGraph g = JanusGraphFactory.build().
set(<span class="hl-string">"storage.backend"</span>, <span class="hl-string">"cql"</span>).
set(<span class="hl-string">"storage.hostname"</span>, <span class="hl-string">"127.0.0.1"</span>).
open();</pre></li></ol></div><p>In the Gremlin Console, you can not define the type of the variables <code class="literal">conf</code> and <code class="literal">g</code>. Therefore, simply leave off the type declaration.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_local_container_mode"></a>17.3.&nbsp;Local Container Mode</h2></div></div></div><p>Cassandra does not have a native install for Windows or OSX. One of the easiest ways to run Cassandra on OSX, Windows, or Linux is to use a Docker Container. You can download and run Cassandra with a single <a class="link" href="https://www.docker.com/" target="_top">Docker</a> command. It is important to install a version that is supported by the version of JanusGraph you intend to use. The compatible versions can be found under the Tested Compatibility section of the specific release on the <a class="link" href="https://github.com/JanusGraph/janusgraph/releases" target="_top">Releases page</a>. The <a class="link" href="https://hub.docker.com/_/cassandra/" target="_top">Cassandra Docker Hub page</a> can be referenced for the available versions and useful commands. In the command below an environment variable is being set to enable Cassandra Thrift with <code class="literal">-e CASSANDRA_START_RPC=true</code>. A description of the ports can be found <a class="link" href="https://docs.datastax.com/en/cassandra/latest/cassandra/configuration/secureFireWall.html" target="_top">here</a>. Port 9160 is used for the Thrift client API. Port 9042 is for CQL native clients. Ports 7000, 7001 and 7099 are for inter-node communication. Version 3.11 of Cassandra was the latest compatible version for JanusGraph 0.2.0 and is specified in the reference command below.</p><pre class="programlisting">docker run --name jg-cassandra -d -e CASSANDRA_START_RPC=true -p 9160:9160 \
-p 9042:9042 -p 7199:7199 -p 7001:7001 -p 7000:7000 cassandra:3.11</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_remote_server_mode"></a>17.4.&nbsp;Remote Server Mode</h2></div></div></div><p><span class="inlinemediaobject"><img src="images/modes-distributed.png" alt="modes-distributed"></span></p><p>When the graph needs to scale beyond the confines of a single machine, then Cassandra and JanusGraph are logically separated into different machines. In this model, the Cassandra cluster maintains the graph representation and any number of JanusGraph instances maintain socket-based read/write access to the Cassandra cluster. The end-user application can directly interact with JanusGraph within the same JVM as JanusGraph.</p><p>For example, suppose we have a running Cassandra cluster where one of the machines has the IP address 77.77.77.77, then connecting JanusGraph with the cluster is accomplished as follows (comma separate IP addresses to reference more than one machine):</p><pre class="programlisting">JanusGraph graph = JanusGraphFactory.build().
set(<span class="hl-string">"storage.backend"</span>, <span class="hl-string">"cql"</span>).
set(<span class="hl-string">"storage.hostname"</span>, <span class="hl-string">"77.77.77.77"</span>).
open();</pre><p>In the Gremlin Console, you can not define the type of the variables <code class="literal">conf</code> and <code class="literal">g</code>. Therefore, simply leave off the type declaration.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_remote_server_mode_with_gremlin_server"></a>17.5.&nbsp;Remote Server Mode with Gremlin Server</h2></div></div></div><p><span class="inlinemediaobject"><img src="images/modes-rexster.png" alt="modes-rexster"></span></p><p>Gremlin Server can be wrapped around each JanusGraph instance defined in the previous subsection. In this way, the end-user application need not be a Java-based application as it can communicate with Gremlin Server as a client. This type of deployment is great for polyglot architectures where various components written in different languages need to reference and compute on the graph.</p><p>Start Gremlin Server using <code class="literal">bin/gremlin-server.sh</code> and then in an external Gremlin Console session using <code class="literal">bin/gremlin.sh</code> you can send Gremlin commands over the wire:</p><pre class="screen">:plugin use tinkerpop.server
:remote connect tinkerpop.server conf/remote.yaml
:&gt; g.addV()</pre><p>In this case, each Gremlin Server would be configured to connect to the Cassandra cluster. The following shows the graph specific fragment of the Gremlin Server configuration. Refer to <a class="xref" href="server.html" title="Chapter&nbsp;7.&nbsp;JanusGraph Server">Chapter&nbsp;7, <i>JanusGraph Server</i></a> for a complete example and more information on how to configure the server.</p><pre class="programlisting">...
graphs: {
  g: conf/janusgraph-cql.properties}
plugins:
  - janusgraph.imports
...</pre><p>For more information about Gremlin Server see the <a class="link" href="http://tinkerpop.apache.org/docs/3.2.9/reference#gremlin-server" target="_top">Apache TinkerPop documentation</a></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_janusgraph_embedded_mode"></a>17.6.&nbsp;JanusGraph Embedded Mode</h2></div></div></div><p><span class="inlinemediaobject"><img src="images/modes-embedded.png" alt="modes-embedded"></span></p><p>Finally, Cassandra can be embedded in JanusGraph, which means, that JanusGraph and Cassandra run in the same JVM and communicate via in process calls rather than over the network. This removes the (de)serialization and network protocol overhead and can therefore lead to considerable performance improvements. In this deployment mode, JanusGraph internally starts a cassandra daemon and JanusGraph no longer connects to an existing cluster but is its own cluster.</p><p>To use JanusGraph in embedded mode, simply configure <code class="literal">embeddedcassandra</code> as the storage backend. The configuration options listed below also apply to embedded Cassandra. In creating a JanusGraph cluster, ensure that the individual nodes can discover each other via the Gossip protocol, so setup a JanusGraph-with-Cassandra-embedded cluster much like you would a stand alone Cassandra cluster. When running JanusGraph in embedded mode, the Cassandra yaml file is configured using the additional configuration option <code class="literal">storage.conf-file</code>, which specifies the yaml file as a full url, e.g. <code class="literal">storage.conf-file = file:///home/cassandra.yaml</code>.</p><p>When running a cluster with JanusGraph and Cassandra embedded, it is advisable to expose JanusGraph through the Gremlin Server so that applications can remotely connect to the JanusGraph graph database and execute queries.</p><p>Note, that running JanusGraph with Cassandra embedded requires GC tuning. While embedded Cassandra can provide lower latency query answering, its GC behavior under load is less predictable.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_cassandra_specific_configuration"></a>17.7.&nbsp;Cassandra Specific Configuration</h2></div></div></div><p>Refer to <a class="xref" href="config-ref.html" title="Chapter&nbsp;14.&nbsp;Configuration Reference">Chapter&nbsp;14, <i>Configuration Reference</i></a> for a complete listing of all Cassandra specific configuration options in addition to the general JanusGraph configuration options.</p><p>When configuring Cassandra it is recommended to consider the following Cassandra specific configuration options:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>read-consistency-level</strong></span>: Cassandra consistency level for read operations</li><li class="listitem"><span class="strong"><strong>write-consistency-level</strong></span>: Cassandra consistency level for write operations</li><li class="listitem"><span class="strong"><strong>replication-factor</strong></span>: The replication factor to use. The higher the replication factor, the more robust the graph database is to machine failure at the expense of data duplication. <span class="strong"><strong>The default value should be overwritten for production system to ensure robustness. A value of 3 is recommended.</strong></span> This replication factor can only be set when the keyspace is initially created. <span class="strong"><strong>On an existing keyspace, this value is ignored.</strong></span></li><li class="listitem"><span class="strong"><strong>thrift.frame_size_mb</strong></span>: The maximum frame size to be used by thrift for transport. Increase this value when retrieving very large result sets. <span class="strong"><strong>Only applicable when storage.backend=cassandrathrift</strong></span></li><li class="listitem"><span class="strong"><strong>keyspace</strong></span>: The name of the keyspace to store the JanusGraph graph in. Allows multiple JanusGraph graphs to co-exist in the same Cassandra cluster.</li></ul></div><p>For more information on Cassandra consistency levels and acceptable values, please refer to the <a class="link" href="http://wiki.apache.org/cassandra/API10" target="_top">Cassandra Thrift API</a>. In general, higher levels are more consistent and robust but have higher latency.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_global_graph_operations"></a>17.8.&nbsp;Global Graph Operations</h2></div></div></div><p>JanusGraph over Cassandra supports global vertex and edge iteration. However, note that all these vertices and/or edges will be loaded into memory which can cause <code class="literal">OutOfMemoryException</code>. Use <a class="xref" href="hadoop-tp3.html" title="Chapter&nbsp;36.&nbsp;JanusGraph with TinkerPop&#8217;s Hadoop-Gremlin">Chapter&nbsp;36, <i>JanusGraph with TinkerPop&#8217;s Hadoop-Gremlin</i></a> to iterate over all vertices or edges in large graphs effectively.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_deploying_on_amazon_ec2"></a>17.9.&nbsp;Deploying on Amazon EC2</h2></div></div></div><div class="blockquote"><table border="0" class="blockquote" style="width: 100%; cellspacing: 0; cellpadding: 0;" summary="Block quote"><tr><td width="10%" valign="top">&nbsp;</td><td width="80%" valign="top"><p>Amazon Elastic Compute Cloud (Amazon EC2) is a web service that provides resizable compute capacity in the cloud. It is designed to make web-scale computing easier for developers.</p></td><td width="10%" valign="top">&nbsp;</td></tr><tr><td width="10%" valign="top">&nbsp;</td><td colspan="2" align="right" valign="top">--<span class="attribution">
    
    <a class="link" href="http://aws.amazon.com/ec2/" target="_top">Amazon EC2</a>
    
    
  </span></td></tr></table></div><p>Follow these steps to setup a Cassandra cluster on EC2 and deploy JanusGraph over Cassandra. To follow these instructions, you need an Amazon AWS account with established authentication credentials and some basic knowledge of AWS and EC2.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_setup_cassandra_cluster"></a>17.9.1.&nbsp;Setup Cassandra Cluster</h3></div></div></div><p>These instructions for configuring and launching the DataStax Cassandra Community Edition AMI are based on the DataStax AMI Docs and focus on aspects relevant for a JanusGraph deployment.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_setting_up_security_group"></a>17.9.2.&nbsp;Setting up Security Group</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Navigate to the EC2 Console Dashboard, then click on "Security Groups" under "Network &amp; Security".</li><li class="listitem">Create a new security group. Click Inbound.  Set the "Create a new rule" dropdown menu to "Custom TCP rule".  Add a rule for port 22 from source 0.0.0.0/0.  Add a rule for ports 1024-65535 from the security group members.  If you don&#8217;t want to open all unprivileged ports among security group members, then at least open 7000, 7199, and 9160 among security group members.  Tip: the "Source" dropdown will autocomplete security group identifiers once "sg" is typed in the box, so you needn&#8217;t have the exact value ready beforehand.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_launch_datastax_cassandra_ami"></a>17.9.3.&nbsp;Launch DataStax Cassandra AMI</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">"Launch the <a class="link" href="https://aws.amazon.com/amis/datastax-auto-clustering-ami-2-2" target="_top">DataStax AMI</a> in your desired zone</li><li class="listitem">On the Instance Details page of the Request Instances Wizard, set "Number of Instances" to your desired number of Cassandra nodes. Set "Instance Type" to at least m1.large. We recommend m1.large.</li><li class="listitem">On the Advanced Instance Options page of the Request Instances Wizard, set the "as text" radio button under "User Data", then fill this into the text box:</li></ul></div><pre class="screen">--clustername [cassandra-cluster-name]
--totalnodes [number-of-instances]
--version community
--opscenter no</pre><p>[number-of-instances] in this configuration must match the number of EC2 instances configured on the previous wizard page. [cassandra-cluster-name] can be any string used for identification. For example:</p><pre class="screen">--clustername janusgraph
--totalnodes 4
--version community
--opscenter no</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">On the Tags page of the Request Instances Wizard you can apply any desired configurations. These tags exist only at the EC2 administrative level and have no effect on the Cassandra daemons' configuration or operation.</li><li class="listitem">On the Create Key Pair page of the Request Instances Wizard, either select an existing key pair or create a new one.  The PEM file containing the private half of the selected key pair will be required to connect to these instances.</li><li class="listitem">On the Configure Firewall page of the Request Instances Wizard, select the security group created earlier.</li><li class="listitem">Review and launch instances on the final wizard page.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_verify_successful_instance_launch"></a>17.9.4.&nbsp;Verify Successful Instance Launch</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">SSH into any Cassandra instance node: <code class="literal">ssh -i [your-private-key].pem ubuntu@[public-dns-name-of-any-cassandra-instance]</code></li><li class="listitem">Run the Cassandra nodetool <code class="literal">nodetool -h 127.0.0.1 ring</code> to inspect the state of the Cassandra token ring.  You should see as many nodes in this command&#8217;s output as instances launched in the previous steps.</li></ul></div><p>Note, that the AMI takes a few minutes to configure each instance. A shell prompt will appear upon successful configuration when you SSH into the instance.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_launch_janusgraph_instances"></a>17.9.5.&nbsp;Launch JanusGraph Instances</h3></div></div></div><p>Launch additional EC2 instances to run JanusGraph which are either configured in Remote Server Mode or Remote Server Mode with Gremlin-Server as described above. You only need to note the IP address of one of the Cassandra cluster instances and configure it as the host name. The particular EC2 instance to run and the particular configuration depends on your use case.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_example_janusgraph_instance_on_amazon_linux_ami"></a>17.9.6.&nbsp;Example JanusGraph Instance on Amazon Linux AMI</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Launch the <a class="link" href="http://aws.amazon.com/amazon-linux-ami" target="_top">Amazon Linux AMI</a> in the same zone of the Cassandra cluster. Choose your desired EC2 instance type depending on the amount of resources you need. Use the default configuration options and select the same Key Pair and Security Group as for the Cassandra cluster configured in the previous step.</li><li class="listitem">SSH into the newly created instance via <code class="literal">ssh -i [your-private-key].pem ec2-user@[public-dns-name-of-the-instance]</code>. You may have to wait a little for the instance to launch.</li><li class="listitem"><a class="link" href="https://github.com/JanusGraph/janusgraph/releases" target="_top">Download</a> the current JanusGraph distribution with <code class="literal">wget</code> and unpack the archive locally to the home directory. Start the Gremlin Console to verify that JanusGraph runs successfully. For more information on how to unpack JanusGraph and start the Gremlin Console, please refer to the <a class="link" href="getting-started.html" title="Chapter&nbsp;3.&nbsp;Getting Started">Getting Started guide</a></li><li class="listitem"><p class="simpara">Create a configuration file with <code class="literal">vi janusgraph.properties</code> and add the following lines::</p><pre class="literallayout">storage.backend = cql
storage.hostname = [IP-address-of-one-Cassandra-EC2-instance]</pre></li></ul></div><p>You may add additional configuration options found on this page or in <a class="xref" href="config-ref.html" title="Chapter&nbsp;14.&nbsp;Configuration Reference">Chapter&nbsp;14, <i>Configuration Reference</i></a>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p class="simpara">Start the Gremlin Console again and type the following::</p><pre class="literallayout">gremlin&gt; graph = JanusGraphFactory.open('janusgraph.properties')
==&gt;janusgraph[cql:[IP-address-of-one-Cassandra-EC2-instance]]</pre></li></ul></div><p>You have successfully connected this JanusGraph instance to the Cassandra cluster and can start to operate on the graph.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_connect_to_cassandra_cluster_in_ec2_from_outside_ec2"></a>17.9.7.&nbsp;Connect to Cassandra cluster in EC2 from outside EC2</h3></div></div></div><p>Opening the usual Cassandra ports (9160, 7000, 7199) in the security group is not enough, because the Cassandra nodes by default broadcast their ec2-internal IPs, and not their public-facing IPs.</p><p>The resulting behavior is that you can open a JanusGraph graph on the cluster by connecting to port 9160 on any Cassandra node, but all requests to that graph time out.  This is because Cassandra is telling the client to connect to an unreachable IP.</p><p>To fix this, set the "broadcast-address" property for each instance in /etc/cassandra/cassandra.yaml to its public-facing IP, and restart the instance.  Do this for all nodes in the cluster.  Once the cluster comes back, nodetool reports the correct public-facing IPs to which connections from the local machine are allowed.</p><p>Changing the "broadcast-address" property allows you to connect to the cluster from outside ec2, but it might also mean that traffic originating within ec2 will have to round-trip to the internet and back before it gets to the cluster.  So, this approach is only useful for development and testing.</p></div></div></div></div><div class="clearer"></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="storage-backends.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="storage-backends.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="hbase.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Part&nbsp;III.&nbsp;Storage Backends&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;18.&nbsp;Apache HBase</td></tr></table></div><div class="footer-wrapper"><footer id="footer"><div class="copyright">
              Copyright &copy; 2017 JanusGraph Authors. All rights reserved.<br>
              The Linux Foundation has registered trademarks and uses trademarks. For a list of<br>
              trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage">Trademark Usage</a> page.<br>
              Cassandra, Groovy, HBase, Hadoop, Lucene, Solr, and TinkerPop are trademarks of the Apache Software Foundation.<br>
              Berkeley DB and Berkeley DB Java Edition are trademarks of Oracle.<br>
              Documentation generated with <a href="http://www.methods.co.nz/asciidoc/">AsciiDoc</a>, <a href="http://asciidoctor.org/">AsciiDoctor</a>, <a href="http://docbook.sourceforge.net/">DocBook</a>, and <a href="http://saxon.sourceforge.net/">Saxon</a>.
        	  </div></footer></div></div></body></html>