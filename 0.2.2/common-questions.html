<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;15.&nbsp;Common Questions</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="JanusGraph Documentation"><link rel="up" href="basics.html" title="Part&nbsp;II.&nbsp;JanusGraph Basics"><link rel="prev" href="config-ref.html" title="Chapter&nbsp;14.&nbsp;Configuration Reference"><link rel="next" href="limitations.html" title="Chapter&nbsp;16.&nbsp;Technical Limitations"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-1.11.0.js"></script><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="js/jquery/jquery-migrate-1.2.1.min.js"></script><link xmlns:d="http://docbook.org/ns/docbook" rel="stylesheet" id="inline-blob-janusgraph-docs-specific" href="css/docs.css" type="text/css" media="all"><link xmlns:d="http://docbook.org/ns/docbook" rel="apple-touch-icon" type="image/png" href="images/janusgraph-logomark.png"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript">
      WebFontConfig = {
        google: {
          families: [
            "Lato:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Open+Sans:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese",
            "Antic+Slab:400,400italic,700,700italic:latin,greek-ext,cyrillic,latin-ext,greek,cyrillic-ext,vietnamese"
          ]
        }
      };
      (function() {
      var wf = document.createElement('script');
      wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
        '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
	wf.type = 'text/javascript';
	wf.async = 'true';
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(wf, s);
	})();
    </script></head><body xmlns:d="http://docbook.org/ns/docbook" bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div id="wrapper"><div class="header-wrapper"><header id="header"><ul class="header-list"><li class="header-item"><a href="http://janusgraph.org"><img src="images/janusgraph-logo.png" alt="JanusGraph" class="normal_logo"></a></li><li class="header-item-right"><a href="https://github.com/JanusGraph/janusgraph/releases">Download JanusGraph</a></li><li class="header-item-right dropdown"><a href="https://docs.janusgraph.org/latest/doc-versions.html">Other Doc Versions</a><div class="dropdown-content"><a href="https://docs.janusgraph.org/latest/index.html">Latest</a><a href="https://docs.janusgraph.org/0.3.0/index.html">Version 0.3.0</a><a href="https://docs.janusgraph.org/0.2.2/index.html">Version 0.2.2</a><a href="https://docs.janusgraph.org/0.2.1/index.html">Version 0.2.1</a><a href="https://docs.janusgraph.org/0.2.0/index.html">Version 0.2.0</a><a href="https://docs.janusgraph.org/0.1.1/index.html">Version 0.1.1</a><a href="https://docs.janusgraph.org/0.1.0/index.html">Version 0.1.0</a></div></li><li class="header-item-right"><a href="index.html">Documentation (0.2.2)</a></li></ul></header></div><div id="main" class="clearfix width-100"><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">JanusGraph Documentation</a></span> &gt; <span class="breadcrumb-link"><a href="basics.html">JanusGraph Basics</a></span> &gt; <span class="breadcrumb-node">Common Questions</span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="common-questions"></a>Chapter&nbsp;15.&nbsp;Common Questions</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="common-questions.html#_accidental_type_creation">15.1. Accidental type creation</a></span></dt><dt><span class="section"><a href="common-questions.html#_custom_class_datatype">15.2. Custom Class Datatype</a></span></dt><dt><span class="section"><a href="common-questions.html#_transactional_scope_for_edges">15.3. Transactional Scope for Edges</a></span></dt><dt><span class="section"><a href="common-questions.html#_locking_exceptions">15.4. Locking Exceptions</a></span></dt><dt><span class="section"><a href="common-questions.html#_ghost_vertices">15.5. Ghost Vertices</a></span></dt><dt><span class="section"><a href="common-questions.html#_debug_level_logging_slows_execution">15.6. Debug-level Logging Slows Execution</a></span></dt><dt><span class="section"><a href="common-questions.html#_janusgraph_outofmemoryexception_or_excessive_garbage_collection">15.7. JanusGraph OutOfMemoryException or excessive Garbage Collection</a></span></dt><dt><span class="section"><a href="common-questions.html#_jamm_warning_messages">15.8. JAMM Warning Messages</a></span></dt><dt><span class="section"><a href="common-questions.html#_cassandra_connection_problem">15.9. Cassandra Connection Problem</a></span></dt><dt><span class="section"><a href="common-questions.html#_elasticsearch_outofmemoryexception">15.10. Elasticsearch OutOfMemoryException</a></span></dt><dt><span class="section"><a href="common-questions.html#_dropping_a_database">15.11. Dropping a Database</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_accidental_type_creation"></a>15.1.&nbsp;Accidental type creation</h2></div></div></div><p>By default, JanusGraph will automatically create property keys and edge labels when a new type is encountered. It is strongly encouraged that users explicitly schemata as documented in <a class="xref" href="schema.html" title="Chapter&nbsp;5.&nbsp;Schema and Data Modeling">Chapter&nbsp;5, <i>Schema and Data Modeling</i></a> before loading any data and disable automatic type creation by setting the option <code class="literal">schema.default = none</code>.</p><p>Automatic type creation can cause problems in multi-threaded or highly concurrent environments. Since JanusGraph needs to ensure that types are unique, multiple attempts at creating the same type will lead to locking or other exceptions. It is generally recommended to create all needed types up front or in one batch when new property keys and edge labels are needed.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_custom_class_datatype"></a>15.2.&nbsp;Custom Class Datatype</h2></div></div></div><p>JanusGraph supports arbitrary objects as attribute values on properties. To use a custom class as data type in JanusGraph, either register a custom serializer or ensure that the class has a no-argument constructor and implements the <code class="literal">equals</code> method because JanusGraph will verify that it can successfully de-/serialize objects of that class. Please see <a class="xref" href="serializer.html" title="Chapter&nbsp;35.&nbsp;Datatype and Attribute Serializer Configuration">Chapter&nbsp;35, <i>Datatype and Attribute Serializer Configuration</i></a> for more information.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_transactional_scope_for_edges"></a>15.3.&nbsp;Transactional Scope for Edges</h2></div></div></div><p>Edges should not be accessed outside the scope in which they were originally created or retrieved.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_locking_exceptions"></a>15.4.&nbsp;Locking Exceptions</h2></div></div></div><p>When defining unique types with <a class="link" href="eventual-consistency.html" title="Chapter&nbsp;30.&nbsp;Eventually-Consistent Storage Backends">locking enabled</a> (i.e. requesting that JanusGraph ensures uniqueness) it is likely to encounter locking exceptions of the type <code class="literal">PermanentLockingException</code> under concurrent modifications to the graph.</p><p>Such exceptions are to be expected, since JanusGraph cannot know how to recover from a transactional state where an earlier read value has been modified by another transaction since this may invalidate the state of the transaction. In most cases it is sufficient to simply re-run the transaction. If locking exceptions are very frequent, try to analyze and remove the source of congestion.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_ghost_vertices"></a>15.5.&nbsp;Ghost Vertices</h2></div></div></div><p>When the same vertex is concurrently removed in one transaction and modified in another, both transactions will successfully commit on eventually consistent storage backends and the vertex will still exist with only the modified properties or edges. This is referred to as a ghost vertex. It is possible to guard against ghost vertices on eventually consistent backends using key <a class="link" href="indexes.html#index-unique" title="10.1.1.1.&nbsp;Index Uniqueness">uniqueness</a> but this is prohibitively expensive in most cases. A more scalable approach is to allow ghost vertices temporarily and clearing them out in regular time intervals.</p><p>Another option is to detect them at read-time using the option <code class="literal">checkInternalVertexExistence()</code> documented in <a class="xref" href="tx.html#tx-config" title="11.8.&nbsp;Transaction Configuration">Section&nbsp;11.8, &#8220;Transaction Configuration&#8221;</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_debug_level_logging_slows_execution"></a>15.6.&nbsp;Debug-level Logging Slows Execution</h2></div></div></div><p>When the log level is set to <code class="literal">DEBUG</code> JanusGraph produces <span class="strong"><strong>a lot</strong></span> of logging output which is useful to understand how particular queries get compiled, optimized, and executed. However, the output is so large that it will impact the query performance noticeably. Hence, use <code class="literal">INFO</code> severity or higher for production systems or benchmarking.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_janusgraph_outofmemoryexception_or_excessive_garbage_collection"></a>15.7.&nbsp;JanusGraph OutOfMemoryException or excessive Garbage Collection</h2></div></div></div><p>If you experience memory issues or excessive garbage collection while running JanusGraph it is likely that the caches are configured incorrectly. If the caches are too large, the heap may fill up with cache entries. Try reducing the size of the transaction level cache before tuning the database level cache, in particular if you have many concurrent transactions. See <a class="xref" href="caching.html" title="Chapter&nbsp;12.&nbsp;JanusGraph Cache">Chapter&nbsp;12, <i>JanusGraph Cache</i></a> for more information.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_jamm_warning_messages"></a>15.8.&nbsp;JAMM Warning Messages</h2></div></div></div><p>When launching JanusGraph with embedded Cassandra, the following warnings may be displayed:</p><p><code class="literal">958 [MutationStage:25] WARN  org.apache.cassandra.db.Memtable  - MemoryMeter uninitialized (jamm not specified as java agent); assuming liveRatio of 10.0.  Usually this means cassandra-env.sh disabled jamm because you are using a buggy JRE; upgrade to the Sun JRE instead</code></p><p>Cassandra uses a Java agent called <code class="literal">MemoryMeter</code> which allows it to measure the actual memory use of an object, including JVM overhead.  To use <a class="link" href="https://github.com/jbellis/jamm" target="_top">JAMM</a> (Java Agent for Memory Measurements), the path to the JAMM jar must be specific in the Java javaagent parameter when launching the JVM (e.g. <code class="literal">-javaagent:path/to/jamm.jar</code>) through either janusgraph.sh, gremlin.sh, or Gremlin Server:</p><pre class="programlisting">export JANUSGRAPH_JAVA_OPTS=-javaagent:$JANUSGRAPH_HOME/lib/jamm-0.3.0.jar</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_cassandra_connection_problem"></a>15.9.&nbsp;Cassandra Connection Problem</h2></div></div></div><p>By default, JanusGraph uses the Astyanax library to connect to Cassandra clusters. On EC2 and Rackspace, it has been reported that Astyanax was unable to establish a connection to the cluster. In those cases, changing the backend to <code class="literal">storage.backend=cassandrathrift</code> solved the problem.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_elasticsearch_outofmemoryexception"></a>15.10.&nbsp;Elasticsearch OutOfMemoryException</h2></div></div></div><p>When numerous clients are connecting to Elasticsearch, it is likely that an <code class="literal">OutOfMemoryException</code> occurs. This is not due to a memory issue, but to the OS not allowing more threads to be spawned by the user (the user running Elasticsearch). To circumvent this issue, increase the number of allowed processes to the user running Elasticsearch. For example, increase the <code class="literal">ulimit -u</code> from the default 1024 to 10024.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_dropping_a_database"></a>15.11.&nbsp;Dropping a Database</h2></div></div></div><p>To drop a database using the Gremlin Console you can call <code class="literal">JanusGraphFactory.drop(graph)</code>. The graph you want to drop needs to be defined prior to running the drop method.</p><p>With ConfiguredGraphFactory</p><pre class="programlisting">graph<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>ConfiguredGraphFactory.open<span class="hl-gremlin-func">(</span><span class="hl-string">'example'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>ConfiguredGraphFactory.drop<span class="hl-gremlin-func">(</span><span class="hl-string">'example'</span><span class="hl-gremlin-func">)</span>;</pre><p>With JanusGraphFactory</p><pre class="programlisting">graph<span class="hl-gremlin-func"> </span>=<span class="hl-gremlin-func"> </span>JanusGraphFactory.open<span class="hl-gremlin-func">(</span><span class="hl-string">'path/to/configuration.properties'</span><span class="hl-gremlin-func">)</span><span class="hl-gremlin-func">
</span>JanusGraphFactory.drop<span class="hl-gremlin-func">(</span>graph<span class="hl-gremlin-func">)</span>;</pre><p>Note that on JanusGraph versions prior to 0.3.0 if multiple Gremlin Server instances are connecting to the graph that has been dropped it is reccomended to close the graph on all active nodes by running either <code class="literal">JanusGraphFactory.close(graph)</code> or <code class="literal">ConfiguredGraphFactory.close("example")</code> depending on which graph manager is in use. Closing and reopening the graph on all active nodes will prevent cached(stale) references to the graph that has been dropped. ConfiguredGraphFactory graphs that are dropped may need to have their configurations recreated using the <a class="link" href="configuredgraphfactory.html#graph-configurations" title="9.8.1.&nbsp;Graph Configurations">graph configuration singleton</a> or <a class="link" href="configuredgraphfactory.html#template-configuration" title="9.8.2.&nbsp;Template Configuration">template configuration</a>.</p></div></div></div><div class="clearer"></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="config-ref.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="basics.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="limitations.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;14.&nbsp;Configuration Reference&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;16.&nbsp;Technical Limitations</td></tr></table></div><div class="footer-wrapper"><footer id="footer"><div class="copyright">
              Copyright &copy; 2017 JanusGraph Authors. All rights reserved.<br>
              The Linux Foundation has registered trademarks and uses trademarks. For a list of<br>
              trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage">Trademark Usage</a> page.<br>
              Cassandra, Groovy, HBase, Hadoop, Lucene, Solr, and TinkerPop are trademarks of the Apache Software Foundation.<br>
              Berkeley DB and Berkeley DB Java Edition are trademarks of Oracle.<br>
              Documentation generated with <a href="http://www.methods.co.nz/asciidoc/">AsciiDoc</a>, <a href="http://asciidoctor.org/">AsciiDoctor</a>, <a href="http://docbook.sourceforge.net/">DocBook</a>, and <a href="http://saxon.sourceforge.net/">Saxon</a>.
        	  </div></footer></div></div></body></html>